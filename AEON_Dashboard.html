<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AEON-Delta v3.1 ‚Äî Live Control Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Oxanium:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #060810; --bg2: #0a0d14; --surface: #0e1220; --surface2: #141826;
  --surface3: #1a1f30; --border: #1e2535; --border2: #252d40;
  --accent: #00d4ff; --accent-dim: rgba(0,212,255,0.1); --accent-glow: rgba(0,212,255,0.22);
  --purple: #7c3aed; --purple-dim: rgba(124,58,237,0.1);
  --green: #10b981; --green-dim: rgba(16,185,129,0.1);
  --warn: #f59e0b; --warn-dim: rgba(245,158,11,0.1);
  --danger: #ef4444; --danger-dim: rgba(239,68,68,0.1);
  --text: #e2e8f0; --text2: #94a3b8; --text3: #64748b;
  --mono: 'JetBrains Mono', monospace; --display: 'Oxanium', sans-serif;
  --r: 10px; --rlg: 14px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: var(--bg); color: var(--text); font-family: var(--mono); font-size: 13px; line-height: 1.5; overflow-x: hidden; }
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--bg2); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.shell { display: grid; grid-template-columns: 210px 1fr; grid-template-rows: 50px 1fr; min-height: 100vh; }

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar { grid-column: 1/-1; background: var(--surface); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 18px; gap: 16px; position: sticky; top: 0; z-index: 200; }
.logo { font-family: var(--display); font-weight: 800; font-size: 17px; letter-spacing: 2px; background: linear-gradient(90deg, var(--accent), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.ver { font-size: 10px; color: var(--text3); border: 1px solid var(--border2); padding: 2px 8px; border-radius: 4px; }
.spacer { flex: 1; }
.conn-badge { display: flex; align-items: center; gap: 6px; font-size: 11px; padding: 4px 12px; border-radius: 6px; border: 1px solid; transition: all 0.3s; }
.conn-badge.connected { background: var(--green-dim); border-color: rgba(16,185,129,0.3); color: var(--green); }
.conn-badge.disconnected { background: var(--danger-dim); border-color: rgba(239,68,68,0.3); color: var(--danger); }
.conn-badge.connecting { background: var(--warn-dim); border-color: rgba(245,158,11,0.3); color: var(--warn); }
.dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
.dot.pulse { animation: pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
.dev-badge { display: flex; align-items: center; gap: 6px; font-size: 11px; background: var(--accent-dim); border: 1px solid rgba(0,212,255,0.2); color: var(--accent); padding: 4px 12px; border-radius: 6px; }
#clock { font-size: 11px; color: var(--text3); }

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar { background: var(--surface); border-right: 1px solid var(--border); padding: 14px 0; overflow-y: auto; position: sticky; top: 50px; height: calc(100vh - 50px); }
.nav-group { margin-bottom: 6px; }
.nav-label { font-size: 9px; letter-spacing: 2px; color: var(--text3); text-transform: uppercase; padding: 8px 14px 4px; }
.nav-item { display: flex; align-items: center; gap: 9px; padding: 7px 12px; margin: 1px 6px; border-radius: var(--r); cursor: pointer; color: var(--text3); font-size: 12px; transition: all 0.12s; border: 1px solid transparent; user-select: none; }
.nav-item:hover { background: var(--surface3); color: var(--text); border-color: var(--border); }
.nav-item.active { background: var(--accent-dim); color: var(--accent); border-color: rgba(0,212,255,0.25); }
.nav-icon { width: 16px; text-align: center; font-size: 13px; flex-shrink: 0; }
.nav-badge { margin-left: auto; font-size: 9px; padding: 1px 6px; border-radius: 10px; background: var(--danger-dim); color: var(--danger); }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { overflow-y: auto; height: calc(100vh - 50px); }
.panel { display: none; padding: 22px; animation: fadeIn 0.18s ease; }
.panel.active { display: block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(3px)} to{opacity:1;transform:translateY(0)} }

/* ‚îÄ‚îÄ COMPONENTS ‚îÄ‚îÄ */
.ph { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
.ph-title { font-family: var(--display); font-size: 20px; font-weight: 700; }
.ph-sub { font-size: 11px; color: var(--text3); margin-top: 2px; }
.btns { display: flex; gap: 8px; flex-wrap: wrap; }

.btn { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: var(--r); font-family: var(--mono); font-size: 12px; cursor: pointer; border: 1px solid transparent; transition: all 0.12s; white-space: nowrap; }
.btn-primary { background: var(--accent); color: #000; border-color: var(--accent); font-weight: 600; }
.btn-primary:hover { background: #1ae0ff; box-shadow: 0 0 14px var(--accent-glow); }
.btn-secondary { background: var(--accent-dim); color: var(--accent); border-color: rgba(0,212,255,0.25); }
.btn-secondary:hover { background: rgba(0,212,255,0.16); }
.btn-danger { background: var(--danger-dim); color: var(--danger); border-color: rgba(239,68,68,0.25); }
.btn-ghost { background: transparent; color: var(--text3); border-color: var(--border); }
.btn-ghost:hover { background: var(--surface3); color: var(--text); }
.btn-green { background: var(--green-dim); color: var(--green); border-color: rgba(16,185,129,0.25); }
.btn:disabled { opacity: 0.35; cursor: not-allowed; pointer-events: none; }
.spinner { display: inline-block; width: 12px; height: 12px; border: 2px solid rgba(0,0,0,0.2); border-top-color: currentColor; border-radius: 50%; animation: spin 0.7s linear infinite; }
@keyframes spin { to{transform:rotate(360deg)} }

.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.g3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; }
.g4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 14px; }
@media(max-width:1100px) { .g4{grid-template-columns:1fr 1fr} .g3{grid-template-columns:1fr 1fr} }
@media(max-width:760px) { .g2,.g3,.g4{grid-template-columns:1fr} .shell{grid-template-columns:1fr} .sidebar{display:none} }

.card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--rlg); padding: 16px; transition: border-color 0.2s; }
.card:hover { border-color: var(--border2); }
.card.ca { border-left: 3px solid var(--accent); }
.card.cg { border-left: 3px solid var(--green); }
.card.cp { border-left: 3px solid var(--purple); }
.card.cw { border-left: 3px solid var(--warn); }
.card.cd { border-left: 3px solid var(--danger); }
.ct { font-size: 10px; color: var(--text3); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 6px; }
.cv { font-family: var(--display); font-size: 26px; font-weight: 700; line-height: 1; }
.cv.ca { color: var(--accent); } .cv.cg { color: var(--green); }
.cv.cp { color: var(--purple); } .cv.cw { color: var(--warn); }
.cm-t { font-size: 10px; color: var(--text3); margin-top: 3px; }
.mbar { height: 3px; background: var(--surface3); border-radius: 2px; margin-top: 8px; overflow: hidden; }
.mfill { height: 100%; border-radius: 2px; background: linear-gradient(90deg,var(--accent),var(--purple)); transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }
.mfill.g { background: var(--green); } .mfill.w { background: var(--warn); } .mfill.d { background: var(--danger); }

.stitle { font-family: var(--display); font-size: 12px; font-weight: 600; color: var(--text2); letter-spacing: 1px; text-transform: uppercase; margin: 20px 0 10px; display: flex; align-items: center; gap: 10px; }
.stitle::after { content:''; flex:1; height:1px; background:var(--border); }

/* FORM */
.fg { display: flex; flex-direction: column; gap: 4px; margin-bottom: 10px; }
.fl { font-size: 10px; color: var(--text2); text-transform: uppercase; letter-spacing: 0.8px; }
.fh { font-size: 10px; color: var(--text3); margin-top: 2px; line-height: 1.4; }
.fr { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
.fr3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
input[type=text],input[type=number],select,textarea { background:var(--surface3); border:1px solid var(--border); border-radius:8px; padding:6px 9px; color:var(--text); font-family:var(--mono); font-size:12px; width:100%; transition:border-color 0.12s; -webkit-appearance:none; }
input:focus,select:focus,textarea:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 2px var(--accent-dim); }
textarea { resize:vertical; min-height:70px; }
.tog-row { display:flex; align-items:center; justify-content:space-between; padding:7px 0; border-bottom:1px solid rgba(255,255,255,0.03); }
.tog-row:last-child { border-bottom:none; }
.tog-info { flex:1; padding-right:10px; }
.tog-name { font-size:12px; color:var(--accent); }
.tog-desc { font-size:10px; color:var(--text3); margin-top:1px; }
.tog-def { font-size:9px; color:var(--warn); }
.tog { position:relative; width:36px; height:19px; flex-shrink:0; }
.tog input { display:none; }
.tog-track { position:absolute; inset:0; background:var(--surface3); border:1px solid var(--border2); border-radius:10px; cursor:pointer; transition:all 0.2s; }
.tog-track::after { content:''; position:absolute; top:2px; left:2px; width:13px; height:13px; border-radius:50%; background:var(--text3); transition:all 0.2s; }
.tog input:checked+.tog-track { background:rgba(0,212,255,0.18); border-color:var(--accent); }
.tog input:checked+.tog-track::after { transform:translateX(17px); background:var(--accent); box-shadow:0 0 5px var(--accent); }
.rr { display:flex; align-items:center; gap:8px; }
input[type=range] { -webkit-appearance:none; height:3px; background:var(--surface3); border-radius:2px; border:none; padding:0; flex:1; }
input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:13px; height:13px; border-radius:50%; background:var(--accent); cursor:pointer; }
.rv { font-size:11px; color:var(--accent); width:46px; text-align:right; flex-shrink:0; }

/* TABS */
.tbar { display:flex; gap:3px; border-bottom:1px solid var(--border); margin-bottom:18px; overflow-x:auto; }
.tbtn { padding:7px 14px; border-radius:var(--r) var(--r) 0 0; cursor:pointer; font-family:var(--mono); font-size:11px; color:var(--text3); border:1px solid transparent; border-bottom:none; transition:all 0.12s; white-space:nowrap; background:transparent; }
.tbtn:hover { color:var(--text); background:var(--surface3); }
.tbtn.active { background:var(--surface); color:var(--accent); border-color:var(--border); border-bottom-color:var(--surface); margin-bottom:-1px; }
.tpanel { display:none; } .tpanel.active { display:block; }

/* LOGS */
.log-wrap { background:#040608; border:1px solid var(--border); border-radius:var(--rlg); height:420px; overflow-y:auto; padding:10px; }
.log-e { display:flex; gap:8px; padding:2px 0; font-size:11px; border-bottom:1px solid rgba(255,255,255,0.015); animation:lf 0.2s ease; }
@keyframes lf { from{opacity:0;transform:translateX(-3px)} to{opacity:1;transform:translateX(0)} }
.lt { color:var(--text3); white-space:nowrap; flex-shrink:0; width:60px; }
.ll { font-weight:600; width:52px; flex-shrink:0; font-size:10px; text-transform:uppercase; }
.ll.INFO{color:var(--accent)} .ll.WARNING{color:var(--warn)} .ll.WARN{color:var(--warn)}
.ll.ERROR{color:var(--danger)} .ll.DEBUG{color:var(--text3)} .ll.SUCCESS{color:var(--green)}
.ls { color:var(--purple); width:80px; flex-shrink:0; font-size:10px; overflow:hidden; text-overflow:ellipsis; }
.lm { color:var(--text2); flex:1; word-break:break-all; }
.log-tb { display:flex; align-items:center; gap:6px; margin-bottom:8px; flex-wrap:wrap; }
.chip { padding:3px 9px; border-radius:10px; border:1px solid var(--border); font-size:10px; cursor:pointer; color:var(--text3); transition:all 0.12s; user-select:none; }
.chip.on-INFO{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.chip.on-WARN,.chip.on-WARNING{border-color:var(--warn);color:var(--warn);background:var(--warn-dim)}
.chip.on-ERROR{border-color:var(--danger);color:var(--danger);background:var(--danger-dim)}
.chip.on-DEBUG{border-color:var(--border2);color:var(--text2);background:var(--surface3)}

/* CODE */
.cb { position:relative; background:#040608; border:1px solid var(--border); border-radius:var(--r); padding:14px; font-size:12px; line-height:1.7; overflow-x:auto; }
.cc { position:absolute; top:7px; right:7px; background:var(--surface3); border:1px solid var(--border); color:var(--text3); padding:2px 9px; border-radius:5px; font-size:10px; cursor:pointer; }
.cc:hover { color:var(--accent); border-color:var(--accent); }

/* ALERT */
.alert { display:flex; gap:10px; padding:10px 14px; border-radius:var(--r); font-size:12px; margin-bottom:10px; line-height:1.5; }
.alert-blue { background:var(--accent-dim); border:1px solid rgba(0,212,255,0.18); color:var(--text2); }
.alert-yellow { background:var(--warn-dim); border:1px solid rgba(245,158,11,0.18); color:var(--text2); }
.alert-green { background:var(--green-dim); border:1px solid rgba(16,185,129,0.18); color:var(--text2); }
.alert-danger { background:var(--danger-dim); border:1px solid rgba(239,68,68,0.18); color:var(--text2); }

/* BADGE */
.badge { display:inline-flex; align-items:center; font-size:9px; letter-spacing:0.8px; text-transform:uppercase; padding:2px 6px; border-radius:4px; font-weight:600; }
.bg { background:var(--green-dim); color:var(--green); border:1px solid rgba(16,185,129,0.2); }
.ba { background:var(--accent-dim); color:var(--accent); border:1px solid rgba(0,212,255,0.2); }
.bw { background:var(--warn-dim); color:var(--warn); border:1px solid rgba(245,158,11,0.2); }
.br { background:var(--danger-dim); color:var(--danger); border:1px solid rgba(239,68,68,0.2); }
.bp { background:var(--purple-dim); color:#a78bfa; border:1px solid rgba(124,58,237,0.2); }

/* PROGRESS */
.prog-track { height:5px; background:var(--surface3); border-radius:3px; overflow:hidden; }
.prog-fill { height:100%; border-radius:3px; background:linear-gradient(90deg,var(--accent),var(--purple)); transition:width 0.4s ease; position:relative; overflow:hidden; }
.prog-fill::after { content:''; position:absolute; inset:0; background:linear-gradient(90deg,transparent,rgba(255,255,255,0.18),transparent); animation:sh 1.4s infinite; }
@keyframes sh { 0%{transform:translateX(-100%)} 100%{transform:translateX(200%)} }

/* OUTPUT */
.out-box { background:#040608; border:1px solid var(--border); border-radius:var(--r); padding:14px; min-height:110px; }
.cursor { display:inline-block; width:2px; height:13px; background:var(--accent); animation:bl 0.8s infinite; vertical-align:text-bottom; }
@keyframes bl { 0%,100%{opacity:1} 50%{opacity:0} }

/* HEALTH RING */
.hring { position:relative; width:90px; height:90px; margin:0 auto; }
.hring svg { transform:rotate(-90deg); }
.hrval { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:var(--display); font-size:18px; font-weight:700; }
.hrlbl { font-size:8px; color:var(--text3); text-transform:uppercase; letter-spacing:1px; }

/* SUBSYS */
.ss-list { display:flex; flex-direction:column; gap:5px; }
.ss-item { display:flex; align-items:center; gap:8px; padding:7px 10px; background:var(--surface3); border-radius:7px; font-size:11px; }
.ss-dot { width:6px; height:6px; border-radius:50%; flex-shrink:0; }
.ss-name { flex:1; color:var(--text2); }
.ss-val { color:var(--accent); font-weight:600; }

/* TABLE */
.tbl { width:100%; border-collapse:collapse; }
.tbl th,.tbl td { padding:7px 11px; border-bottom:1px solid rgba(255,255,255,0.03); font-size:11px; text-align:left; }
.tbl th { color:var(--text3); font-size:10px; text-transform:uppercase; letter-spacing:1px; background:var(--surface3); }
.tbl tr:hover td { background:rgba(255,255,255,0.015); }

/* CODEBOOK */
.cbk { display:grid; grid-template-columns:repeat(32,1fr); gap:2px; margin-top:8px; }
.cbk-c { aspect-ratio:1; border-radius:2px; }

/* CHART */
.chart-wrap { background:var(--surface); border:1px solid var(--border); border-radius:var(--rlg); padding:14px; }
.chart-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
.chart-title { font-size:12px; color:var(--text2); font-weight:600; }
canvas { display:block; width:100%; }

/* ARCH FLOW */
.arch-wrap { background:var(--surface); border:1px solid var(--border); border-radius:var(--rlg); padding:20px; overflow-x:auto; margin-bottom:18px; }
.flow { display:flex; align-items:center; gap:0; min-width:860px; }
.fn { background:var(--bg2); border:1px solid var(--border2); border-radius:7px; padding:8px 12px; font-size:11px; text-align:center; white-space:nowrap; transition:all 0.18s; cursor:default; }
.fn:hover { transform:scale(1.04); z-index:2; }
.fn .fn-n { font-weight:600; }
.fn .fn-s { font-size:9px; color:var(--text3); margin-top:2px; }
.fn.hot { border-color:var(--accent); color:var(--accent); background:rgba(0,212,255,0.05); }
.fn.warm { border-color:var(--purple); color:#a78bfa; background:rgba(124,58,237,0.05); }
.fn.cool { border-color:var(--green); color:var(--green); background:rgba(16,185,129,0.05); }
.fa { color:var(--text3); font-size:15px; padding:0 5px; flex-shrink:0; }
.fb { display:flex; flex-direction:column; gap:5px; }
.fb .fn { font-size:10px; padding:5px 8px; }

hr { border:none; border-top:1px solid var(--border); margin:16px 0; }
</style>
</head>
<body>
<div class="shell">

<!-- TOPBAR -->
<header class="topbar">
  <div class="logo">AEON</div>
  <div class="ver">Delta RMT v3.1.0</div>
  <div class="spacer"></div>
  <div class="conn-badge disconnected" id="conn-badge">
    <div class="dot pulse" id="conn-dot"></div>
    <span id="conn-text">Connecting...</span>
  </div>
  <div class="dev-badge">‚ö° <span id="dev-str">‚Äî</span></div>
  <div id="clock"></div>
</header>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="nav-group">
    <div class="nav-label">Overview</div>
    <div class="nav-item active" onclick="go('dashboard')"><span class="nav-icon">‚óà</span> Dashboard</div>
    <div class="nav-item" onclick="go('architecture')"><span class="nav-icon">‚¨°</span> Architecture</div>
  </div>
  <div class="nav-group">
    <div class="nav-label">Engine</div>
    <div class="nav-item" onclick="go('config')"><span class="nav-icon">‚öô</span> Configuration</div>
    <div class="nav-item" onclick="go('inference')"><span class="nav-icon">‚ñ∂</span> Inference</div>
    <div class="nav-item" onclick="go('training')"><span class="nav-icon">‚óâ</span> Training</div>
  </div>
  <div class="nav-group">
    <div class="nav-label">Monitoring</div>
    <div class="nav-item" onclick="go('logs')"><span class="nav-icon">‚â°</span> Live Logs <span class="nav-badge" id="log-badge">0</span></div>
    <div class="nav-item" onclick="go('audit')"><span class="nav-icon">‚óê</span> Audit Trail</div>
    <div class="nav-item" onclick="go('monitor')"><span class="nav-icon">‚óå</span> System Monitor</div>
    <div class="nav-item" onclick="go('tg')"><span class="nav-icon">üõ°</span> TensorGuard</div>
  </div>
  <div class="nav-group">
    <div class="nav-label">Tools</div>
    <div class="nav-item" onclick="go('codegen')"><span class="nav-icon">&lt;/&gt;</span> Code Generator</div>
  </div>
</nav>

<!-- MAIN -->
<main class="main">

<!-- ‚ïê‚ïê DASHBOARD ‚ïê‚ïê -->
<div class="panel active" id="panel-dashboard">
  <div class="ph">
    <div><div class="ph-title">Control Dashboard</div><div class="ph-sub">AEON-Delta RMT v3.1.0 ¬∑ Live connection to core.py</div></div>
    <div class="btns">
      <button class="btn btn-ghost" onclick="refreshAll()">‚Üª Refresh</button>
      <button class="btn btn-primary" onclick="go('inference')">‚ñ∂ Inference</button>
    </div>
  </div>

  <div class="alert alert-blue" id="no-backend-alert">
    <span>‚ö†</span>
    <div>Backend –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: <code>python aeon_server.py</code> ¬∑ –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</div>
  </div>

  <div class="g4" style="margin-bottom:16px">
    <div class="card ca"><div class="ct">Parameters</div><div class="cv ca" id="d-params">‚Äî</div><div class="cm-t" id="d-params-m">not initialized</div><div class="mbar"><div class="mfill" id="d-params-bar" style="width:0%"></div></div></div>
    <div class="card cg"><div class="ct">Health Score</div><div class="cv cg" id="d-health">‚Äî</div><div class="cm-t" id="d-health-m">‚Äî</div><div class="mbar"><div class="mfill g" id="d-health-bar" style="width:0%"></div></div></div>
    <div class="card cp"><div class="ct">Active Flags</div><div class="cv cp" id="d-flags">0</div><div class="cm-t">AGI subsystems on</div><div class="mbar"><div class="mfill" style="background:var(--purple);width:0%" id="d-flags-bar"></div></div></div>
    <div class="card cw"><div class="ct">VQ Utilization</div><div class="cv cw" id="d-vq">‚Äî</div><div class="cm-t" id="d-vq-m">codebook usage</div><div class="mbar"><div class="mfill w" id="d-vq-bar" style="width:0%"></div></div></div>
  </div>

  <div class="g2" style="margin-bottom:16px">
    <div class="card">
      <div class="ct">üè• System Integrity</div>
      <div style="display:flex;align-items:center;gap:20px;margin-top:8px">
        <div class="hring">
          <svg viewBox="0 0 90 90" width="90" height="90">
            <circle cx="45" cy="45" r="35" fill="none" stroke="var(--surface3)" stroke-width="7"/>
            <circle cx="45" cy="45" r="35" fill="none" stroke="var(--green)" stroke-width="7"
              stroke-dasharray="220" stroke-dashoffset="220" stroke-linecap="round"
              id="d-ring" style="transition:stroke-dashoffset 1s ease"/>
          </svg>
          <div class="hrval"><span id="d-ring-v" style="color:var(--green)">‚Äî</span><span class="hrlbl">health</span></div>
        </div>
        <div class="ss-list" style="flex:1" id="d-subsys"></div>
      </div>
    </div>
    <div class="card">
      <div class="ct">‚óê Recent Decisions (from model.get_recent_decisions)</div>
      <div id="d-decisions" style="margin-top:8px;display:flex;flex-direction:column;gap:3px;max-height:160px;overflow-y:auto">
        <div style="font-size:11px;color:var(--text3)">No decisions yet</div>
      </div>
    </div>
  </div>

  <div class="g2" style="margin-bottom:16px">
    <div class="card">
      <div class="ct">‚óà VQ-VAE Codebook</div>
      <div class="cbk" id="d-cbk"></div>
      <div class="cm-t" id="d-cbk-m" style="margin-top:6px">‚Äî</div>
    </div>
    <div class="card">
      <div class="ct">‚öô TensorGuard Live</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:10px">
        <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">NaN events</div><div style="font-family:var(--display);font-size:22px;color:var(--warn)" id="tg-nan-live">0</div></div>
        <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">Inf events</div><div style="font-family:var(--display);font-size:22px;color:var(--danger)" id="tg-inf-live">0</div></div>
        <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">Sanitized</div><div style="font-family:var(--display);font-size:22px;color:var(--accent)" id="tg-san-live">0</div></div>
      </div>
    </div>
  </div>

  <div class="stitle">Initialize Model</div>
  <div class="card">
    <div style="display:flex;align-items:flex-end;gap:10px;flex-wrap:wrap">
      <div class="fg" style="margin:0;flex:1;min-width:160px">
        <div class="fl">Preset</div>
        <select id="q-preset" onchange="applyPreset(this.value)">
          <option value="minimal">Minimal (core only)</option>
          <option value="production" selected>Production</option>
          <option value="full">Full (Research)</option>
        </select>
      </div>
      <div class="fg" style="margin:0;flex:1;min-width:120px">
        <div class="fl">hidden_dim</div>
        <select id="q-hidden">
          <option value="128">128 (debug)</option>
          <option value="256" selected>256</option>
          <option value="512">512 (prod)</option>
          <option value="1024">1024</option>
        </select>
      </div>
      <div class="fg" style="margin:0;flex:1;min-width:120px">
        <div class="fl">device</div>
        <select id="q-device">
          <option value="auto">auto</option>
          <option value="cpu">cpu</option>
          <option value="cuda">cuda</option>
          <option value="mps">mps (Apple)</option>
        </select>
      </div>
      <div class="fg" style="margin:0;flex:1;min-width:60px">
        <div class="fl">seed</div>
        <input type="number" id="q-seed" value="42" style="width:80px">
      </div>
      <button class="btn btn-primary" id="init-btn" onclick="initModel()">‚ö° Initialize</button>
      <button class="btn btn-danger" id="deinit-btn" onclick="deinitModel()" style="display:none">‚úï Deinit</button>
    </div>
    <div id="init-prog" style="margin-top:12px;display:none">
      <div style="font-size:11px;color:var(--text3);margin-bottom:5px" id="init-step-lbl">Initializing...</div>
      <div class="prog-track"><div class="prog-fill" id="init-prog-fill" style="width:0%"></div></div>
    </div>
    <div id="init-error" class="alert alert-danger" style="margin-top:10px;display:none"></div>
  </div>
</div>

<!-- ‚ïê‚ïê ARCHITECTURE ‚ïê‚ïê -->
<div class="panel" id="panel-architecture">
  <div class="ph">
    <div><div class="ph-title">Architecture</div><div class="ph-sub">Live model structure from model.print_architecture_summary()</div></div>
    <button class="btn btn-secondary" onclick="loadArch()">‚Üª Refresh</button>
  </div>
  <div class="arch-wrap">
    <div style="font-size:10px;color:var(--text3);margin-bottom:14px;text-transform:uppercase;letter-spacing:1px">Data Flow Pipeline</div>
    <div class="flow">
      <div class="fn hot"><div class="fn-n">Input IDs</div><div class="fn-s">[B, L]</div></div>
      <div class="fa">‚Üí</div>
      <div class="fn"><div class="fn-n">Encoder</div><div class="fn-s" id="a-enc">SSM</div></div>
      <div class="fa">‚Üí</div>
      <div class="fn warm"><div class="fn-n">VQ-VAE</div><div class="fn-s" id="a-vq">8192 codes</div></div>
      <div class="fa">‚Üí</div>
      <div class="fn"><div class="fn-n">Meta-Loop</div><div class="fn-s" id="a-ml">Banach FP</div></div>
      <div class="fa">‚Üí</div>
      <div class="fb">
        <div class="fn" id="a-mem">Memory Systems</div>
        <div class="fn" id="a-caus">Causal Models</div>
        <div class="fn">Safety + Topo</div>
        <div class="fn" id="a-plan">Planning</div>
      </div>
      <div class="fa">‚Üí</div>
      <div class="fn cool"><div class="fn-n">C_star</div><div class="fn-s">Core State</div></div>
      <div class="fa">‚Üí</div>
      <div class="fn"><div class="fn-n">Decoder</div><div class="fn-s" id="a-dec">SSM</div></div>
      <div class="fa">‚Üí</div>
      <div class="fn hot"><div class="fn-n">Logits</div><div class="fn-s" id="a-out">[B,L,V]</div></div>
    </div>
  </div>
  <div class="g2" style="margin-bottom:16px">
    <div class="card">
      <div class="ct">Module Breakdown</div>
      <div style="overflow-x:auto;margin-top:8px"><table class="tbl" id="arch-mod-tbl"><tbody><tr><td colspan="3" style="color:var(--text3)">Initialize model to see modules</td></tr></tbody></table></div>
    </div>
    <div class="card">
      <div class="ct">Architecture Summary (raw)</div>
      <div class="cb" style="margin-top:8px;max-height:280px;overflow-y:auto;font-size:10px;padding:10px"><pre id="arch-summary" style="margin:0;color:var(--text2)">Initialize model first</pre></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê CONFIG ‚ïê‚ïê -->
<div class="panel" id="panel-config">
  <div class="ph">
    <div><div class="ph-title">Configuration</div><div class="ph-sub">AEONConfig parameters ‚Äî applied on next init</div></div>
    <div class="btns">
      <button class="btn btn-ghost" onclick="resetCfg()">‚Ü∫ Reset</button>
      <button class="btn btn-secondary" onclick="copyCfgJSON()">‚éò Copy JSON</button>
      <button class="btn btn-primary" onclick="applyAndReinit()">‚ö° Apply & Re-init</button>
    </div>
  </div>
  <div class="tbar" id="cfg-tbar">
    <button class="tbtn active" onclick="cTab('arch')">Architecture</button>
    <button class="tbtn" onclick="cTab('mem')">Memory</button>
    <button class="tbtn" onclick="cTab('causal')">Causality</button>
    <button class="tbtn" onclick="cTab('meta')">Meta-Cognition</button>
    <button class="tbtn" onclick="cTab('coh')">Coherence</button>
    <button class="tbtn" onclick="cTab('plan')">Planning</button>
    <button class="tbtn" onclick="cTab('train')">Training</button>
  </div>

  <div class="tpanel active" id="ctab-arch">
    <div class="alert alert-yellow"><span>‚ö†</span><div><strong>CRITICAL:</strong> vq_embedding_dim MUST equal z_dim ‚Äî AssertionError on violation.</div></div>
    <div class="fr">
      <div class="fg"><div class="fl">encoder_backend</div><select id="c-enc"><option value="ssm" selected>ssm</option><option value="mamba2">mamba2</option><option value="linear_attention">linear_attention</option><option value="lstm">lstm</option></select></div>
      <div class="fg"><div class="fl">decoder_backend</div><select id="c-dec"><option value="ssm" selected>ssm</option><option value="mamba2">mamba2</option><option value="lstm">lstm</option></select></div>
    </div>
    <div class="fr3">
      <div class="fg"><div class="fl">hidden_dim</div><input type="number" id="c-hidden" value="256" min="64" max="2048" step="64"></div>
      <div class="fg"><div class="fl">z_dim</div><input type="number" id="c-zdim" value="256" min="64" max="2048" step="64" oninput="syncVqDim()"></div>
      <div class="fg"><div class="fl">vq_embedding_dim <span class="bw">== z_dim</span></div><input type="number" id="c-vqemb" value="256" min="64" max="2048" step="64" oninput="checkVq()"><div class="fh" id="vq-hint" style="color:var(--green)">‚úì matches z_dim</div></div>
    </div>
    <div class="fr3">
      <div class="fg"><div class="fl">vocab_size</div><select id="c-vocab"><option value="30522" selected>30522 (BERT)</option><option value="50257">50257 (GPT-2)</option><option value="32000">32000 (LLaMA)</option></select></div>
      <div class="fg"><div class="fl">seq_length</div><input type="number" id="c-seqlen" value="64" min="16" max="8192" step="16"></div>
      <div class="fg"><div class="fl">vq_num_embeddings</div><select id="c-vqnum"><option value="8192" selected>8192</option><option value="4096">4096</option><option value="16384">16384 (full)</option></select></div>
    </div>
    <div class="fr">
      <div class="fg"><div class="fl">max_iterations</div><div class="rr"><input type="range" id="c-maxiter" min="5" max="100" value="50" oninput="rv('c-maxiter-v',this.value)"><span class="rv" id="c-maxiter-v">50</span></div></div>
      <div class="fg"><div class="fl">lipschitz_target (< 1.0)</div><div class="rr"><input type="range" id="c-lip" min="0.5" max="0.99" step="0.01" value="0.85" oninput="rv('c-lip-v',parseFloat(this.value).toFixed(2))"><span class="rv" id="c-lip-v">0.85</span></div></div>
    </div>
    <div class="fr">
      <div class="fg"><div class="fl">nan_policy</div><select id="c-nanpol"><option value="WARN" selected>WARN</option><option value="RAISE">RAISE</option><option value="SILENT">SILENT</option><option value="QUARANTINE">QUARANTINE</option></select></div>
      <div class="fg"><div class="fl">device_str</div><select id="c-device"><option value="auto" selected>auto</option><option value="cpu">cpu</option><option value="cuda">cuda</option><option value="mps">mps</option></select></div>
    </div>
    <div>
      <div class="tog-row"><div class="tog-info"><div class="tog-name">use_vq</div><div class="tog-desc">Vector Quantization (discrete representations)</div></div><label class="tog"><input type="checkbox" id="c-usevq" checked><div class="tog-track"></div></label></div>
      <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_inference_cache</div><div class="tog-desc">Cache SSM states for fast inference</div></div><label class="tog"><input type="checkbox" id="c-infcache" checked><div class="tog-track"></div></label></div>
      <div class="tog-row"><div class="tog-info"><div class="tog-name">use_amp</div><div class="tog-desc">Mixed precision (fp16) ‚Äî CUDA only</div></div><label class="tog"><input type="checkbox" id="c-amp" checked><div class="tog-track"></div></label></div>
    </div>
  </div>

  <div class="tpanel" id="ctab-mem">
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_hierarchical_memory</div><div class="tog-desc">STM ‚Üí Episodic ‚Üí Semantic (Miller's 7)</div><div class="tog-def">default: False</div></div><label class="tog"><input type="checkbox" id="c-hier-mem" onchange="dep(this,'mem-hier-sub')"><div class="tog-track"></div></label></div>
    <div id="mem-hier-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fr"><div class="fg"><div class="fl">working_capacity</div><input type="number" id="c-wc" value="7" min="1" max="20"></div><div class="fg"><div class="fl">episodic_capacity</div><input type="number" id="c-ec" value="1000" min="100" max="100000" step="100"></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_neurogenic_memory</div><div class="tog-desc">Bio-inspired neurogenesis memory growth</div><div class="tog-def">default: False</div></div><label class="tog"><input type="checkbox" id="c-neuro-mem" onchange="dep(this,'mem-neuro-sub')"><div class="tog-track"></div></label></div>
    <div id="mem-neuro-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fr"><div class="fg"><div class="fl">retrieval_weight</div><div class="rr"><input type="range" id="c-nrw" min="0" max="1" step="0.01" value="0.1" oninput="rv('c-nrw-v',parseFloat(this.value).toFixed(2))"><span class="rv" id="c-nrw-v">0.10</span></div></div><div class="fg"><div class="fl">retrieval_k</div><input type="number" id="c-nrk" value="3" min="1" max="20"></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_temporal_memory</div><div class="tog-desc">Ebbinghaus forgetting curve decay</div><div class="tog-def">default: False</div></div><label class="tog"><input type="checkbox" id="c-temp-mem" onchange="dep(this,'mem-temp-sub')"><div class="tog-track"></div></label></div>
    <div id="mem-temp-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fg" style="max-width:260px"><div class="fl">decay_rate</div><div class="rr"><input type="range" id="c-tmd" min="0.001" max="0.1" step="0.001" value="0.01" oninput="rv('c-tmd-v',parseFloat(this.value).toFixed(3))"><span class="rv" id="c-tmd-v">0.010</span></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_consolidating_memory</div><div class="tog-desc">3-level consolidation working‚Üíepisodic‚Üísemantic</div><div class="tog-def">default: False</div></div><label class="tog"><input type="checkbox" id="c-cons-mem"><div class="tog-track"></div></label></div>
  </div>

  <div class="tpanel" id="ctab-causal">
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_causal_model</div><div class="tog-desc">NeuralCausalModel ‚Äî basic neural causality</div></div><label class="tog"><input type="checkbox" id="c-causal"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_notears_causal</div><div class="tog-desc">NOTEARS DAG (Zheng 2018, SOTA)</div></div><label class="tog"><input type="checkbox" id="c-notears" onchange="dep(this,'notears-sub')"><div class="tog-track"></div></label></div>
    <div id="notears-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fr"><div class="fg"><div class="fl">num_vars</div><input type="number" id="c-ntvars" value="8" min="2" max="64"></div><div class="fg"><div class="fl">lambda_causal_dag</div><div class="rr"><input type="range" id="c-ldag" min="0.001" max="0.1" step="0.001" value="0.01" oninput="rv('c-ldag-v',parseFloat(this.value).toFixed(3))"><span class="rv" id="c-ldag-v">0.010</span></div></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_causal_world_model</div><div class="tog-desc">CausalWorldModel with structural equations</div></div><label class="tog"><input type="checkbox" id="c-cawm"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_causal_trace</div><div class="tog-desc">Record causal decision chains (audit)</div></div><label class="tog"><input type="checkbox" id="c-catrace"><div class="tog-track"></div></label></div>
    <div class="fg" style="max-width:300px;margin-top:8px"><div class="fl">causal_blend_weight</div><div class="rr"><input type="range" id="c-cbw" min="0" max="0.5" step="0.01" value="0.05" oninput="rv('c-cbw-v',parseFloat(this.value).toFixed(2))"><span class="rv" id="c-cbw-v">0.05</span></div></div>
  </div>

  <div class="tpanel" id="ctab-meta">
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_auto_critic</div><div class="tog-desc">System-2 self-criticism (Kahneman): Critic‚ÜíRevision‚Üíeval</div></div><label class="tog"><input type="checkbox" id="c-ac" onchange="dep(this,'ac-sub')"><div class="tog-track"></div></label></div>
    <div id="ac-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fr"><div class="fg"><div class="fl">threshold</div><div class="rr"><input type="range" id="c-act" min="0.5" max="1" step="0.01" value="0.85" oninput="rv('c-act-v',parseFloat(this.value).toFixed(2))"><span class="rv" id="c-act-v">0.85</span></div></div><div class="fg"><div class="fl">max_iterations</div><input type="number" id="c-acmi" value="3" min="1" max="10"></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_recursive_meta_loop</div><div class="tog-desc">Recursive meta-loop hierarchical deepening</div></div><label class="tog"><input type="checkbox" id="c-rml" onchange="dep(this,'rml-sub')"><div class="tog-track"></div></label></div>
    <div id="rml-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fg" style="max-width:220px"><div class="fl">depth</div><div class="rr"><input type="range" id="c-rmd" min="1" max="10" step="1" value="3" oninput="rv('c-rmd-v',this.value)"><span class="rv" id="c-rmd-v">3</span></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_metacognitive_recursion</div><div class="tog-desc">Auto-trigger deep thinking when uncertainty > threshold</div></div><label class="tog"><input type="checkbox" id="c-mcr"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_meta_learning</div><div class="tog-desc">MAML + EWC: fast adaptation + catastrophic forgetting prevention</div></div><label class="tog"><input type="checkbox" id="c-maml" onchange="dep(this,'maml-sub')"><div class="tog-track"></div></label></div>
    <div id="maml-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fg" style="max-width:280px"><div class="fl">ewc_lambda</div><div class="rr"><input type="range" id="c-ewc" min="10" max="10000" step="10" value="1000" oninput="rv('c-ewc-v',parseFloat(this.value).toFixed(0))"><span class="rv" id="c-ewc-v">1000</span></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_error_evolution</div><div class="tog-desc">Learn from error history to select recovery strategy</div></div><label class="tog"><input type="checkbox" id="c-ee"><div class="tog-track"></div></label></div>
  </div>

  <div class="tpanel" id="ctab-coh">
    <div class="tog-row" style="background:var(--accent-dim);border-radius:8px;padding:10px 14px;border:1px solid rgba(0,212,255,0.2);margin-bottom:12px">
      <div class="tog-info"><div class="tog-name" style="font-size:14px;color:var(--accent)">‚ö° enable_full_coherence</div><div class="tog-desc">MASTER FLAG ‚Äî activates all AGI components at once</div><div class="tog-def" style="color:var(--danger)">10-20x slower ¬∑ use for research only</div></div>
      <label class="tog"><input type="checkbox" id="c-fc" onchange="onFC(this)"><div class="tog-track"></div></label>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_module_coherence</div><div class="tog-desc">Cosine similarity checks between subsystem outputs</div></div><label class="tog"><input type="checkbox" id="c-mc"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_cross_validation</div><div class="tog-desc">factor_state vs causal_state iterative reconciliation</div></div><label class="tog"><input type="checkbox" id="c-cv"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_ns_consistency_check</div><div class="tog-desc">Neural vs symbolic soft-logic consistency</div></div><label class="tog"><input type="checkbox" id="c-nsc"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_hybrid_reasoning</div><div class="tog-desc">NeuroSymbolicBridge + DifferentiableForwardChainer + TemporalKG</div></div><label class="tog"><input type="checkbox" id="c-hr"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_complexity_estimator</div><div class="tog-desc">Skip expensive modules for simple inputs</div></div><label class="tog"><input type="checkbox" id="c-ce"><div class="tog-track"></div></label></div>
  </div>

  <div class="tpanel" id="ctab-plan">
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_world_model</div><div class="tog-desc">PhysicsGroundedWorldModel ‚Äî next-state prediction</div></div><label class="tog"><input type="checkbox" id="c-wm" onchange="dep(this,'wm-sub')"><div class="tog-track"></div></label></div>
    <div id="wm-sub" style="margin-left:22px;opacity:0.4;transition:opacity 0.2s">
      <div class="fr"><div class="fg"><div class="fl">tree_depth</div><input type="number" id="c-wmd" value="3" min="1" max="10"></div><div class="fg"><div class="fl">surprise_threshold</div><div class="rr"><input type="range" id="c-st" min="0.1" max="1" step="0.05" value="0.5" oninput="rv('c-st-v',parseFloat(this.value).toFixed(2))"><span class="rv" id="c-st-v">0.50</span></div></div></div>
    </div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_mcts_planner</div><div class="tog-desc">Monte Carlo Tree Search strategic planning</div></div><label class="tog"><input type="checkbox" id="c-mcts"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_active_learning_planner</div><div class="tog-desc">CuriosityDrivenExploration planner</div></div><label class="tog"><input type="checkbox" id="c-alp"><div class="tog-track"></div></label></div>
    <div class="tog-row"><div class="tog-info"><div class="tog-name">enable_hierarchical_vae</div><div class="tog-desc">Multi-level VAE hierarchical representations</div></div><label class="tog"><input type="checkbox" id="c-hvae"><div class="tog-track"></div></label></div>
  </div>

  <div class="tpanel" id="ctab-train">
    <div class="fr"><div class="fg"><div class="fl">learning_rate</div><select id="c-lr"><option value="1e-5">1e-5</option><option value="3e-5" selected>3e-5</option><option value="1e-4">1e-4</option></select></div><div class="fg"><div class="fl">batch_size</div><select id="c-bs"><option value="4">4</option><option value="8">8</option><option value="16" selected>16</option><option value="32">32</option></select></div></div>
    <div class="fr"><div class="fg"><div class="fl">gradient_clip_norm</div><div class="rr"><input type="range" id="c-gcn" min="0.1" max="5" step="0.1" value="1.0" oninput="rv('c-gcn-v',parseFloat(this.value).toFixed(1))"><span class="rv" id="c-gcn-v">1.0</span></div></div><div class="fg"><div class="fl">warmup_steps</div><input type="number" id="c-ws" value="100" min="0"></div></div>
    <div class="fg"><div class="fl">checkpoint_dir</div><input type="text" id="c-ckpt" value="./checkpoints"></div>
  </div>
</div>

<!-- ‚ïê‚ïê INFERENCE ‚ïê‚ïê -->
<div class="panel" id="panel-inference">
  <div class="ph">
    <div><div class="ph-title">Inference</div><div class="ph-sub">Real-time generation via model.generate() ¬∑ model.forward()</div></div>
    <div id="inf-status" class="badge br">model not initialized</div>
  </div>
  <div class="g2">
    <div>
      <div class="card" style="margin-bottom:14px">
        <div class="ct">‚ñ∂ Generation</div>
        <div class="fg" style="margin-top:8px"><div class="fl">Prompt</div><textarea id="i-prompt" rows="3">What is consciousness?</textarea></div>
        <div class="fr">
          <div class="fg"><div class="fl">max_length</div><div class="rr"><input type="range" id="i-maxlen" min="16" max="256" value="64" oninput="rv('i-ml-v',this.value)"><span class="rv" id="i-ml-v">64</span></div></div>
          <div class="fg"><div class="fl">temperature</div><div class="rr"><input type="range" id="i-temp" min="0.1" max="2.0" step="0.05" value="0.8" oninput="rv('i-t-v',parseFloat(this.value).toFixed(2))"><span class="rv" id="i-t-v">0.80</span></div></div>
        </div>
        <div class="fr">
          <div class="fg"><div class="fl">top_k</div><div class="rr"><input type="range" id="i-topk" min="1" max="200" value="50" oninput="rv('i-tk-v',this.value)"><span class="rv" id="i-tk-v">50</span></div></div>
          <div class="fg"><div class="fl">top_p</div><div class="rr"><input type="range" id="i-topp" min="0.5" max="1" step="0.01" value="0.95" oninput="rv('i-tp-v',parseFloat(this.value).toFixed(2))"><span class="rv" id="i-tp-v">0.95</span></div></div>
        </div>
        <div class="tog-row" style="border:none"><div class="tog-info"><div class="tog-name">fast mode</div><div class="tog-desc">Disables memory/planning/expensive subsystems</div></div><label class="tog"><input type="checkbox" id="i-fast"><div class="tog-track"></div></label></div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn btn-primary" id="i-run-btn" onclick="runInfer()" style="flex:1">‚ñ∂ Generate</button>
          <button class="btn btn-ghost" onclick="clearInfer()">‚úï</button>
        </div>
      </div>
      <div class="card">
        <div class="ct">‚óà Raw Forward Pass</div>
        <div class="fg" style="margin-top:8px"><div class="fl">input_ids (comma-separated)</div><input type="text" id="i-fwd-ids" value="101, 2054, 2003, 4272, 1029, 102"></div>
        <div class="tog-row" style="border:none;padding:4px 0"><div class="tog-info"><div class="tog-name">fast</div></div><label class="tog"><input type="checkbox" id="i-fwd-fast"><div class="tog-track"></div></label></div>
        <button class="btn btn-secondary" onclick="runFwd()" style="margin-top:6px">Run forward()</button>
        <div id="fwd-out" style="margin-top:10px;display:none">
          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px" id="fwd-keys"></div>
          <div style="font-size:11px;color:var(--text3)">safety_score:</div>
          <div style="font-family:var(--display);font-size:20px;font-weight:700" id="fwd-safety"></div>
          <div style="font-size:11px;color:var(--text3);margin-top:6px">top-5 logits (pos 0):</div>
          <div id="fwd-top5" style="font-size:11px;color:var(--text2);margin-top:3px"></div>
          <div style="font-size:11px;color:var(--text3);margin-top:6px">convergence_delta:</div>
          <div id="fwd-delta" style="font-family:var(--display);color:var(--accent)"></div>
        </div>
      </div>
    </div>
    <div>
      <div class="card" style="margin-bottom:14px">
        <div class="ct">‚óâ Output (real model.generate())</div>
        <div class="out-box" id="i-out"><span style="color:var(--text3)">Output will appear here...</span></div>
        <div id="i-meta" style="display:none;margin-top:10px;display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
          <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">Tokens</div><div style="font-family:var(--display);color:var(--accent)" id="im-tok">‚Äî</div></div>
          <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">Time</div><div style="font-family:var(--display);color:var(--accent)" id="im-time">‚Äî</div></div>
          <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">tok/s</div><div style="font-family:var(--display);color:var(--green)" id="im-tps">‚Äî</div></div>
        </div>
        <div id="i-status-line" style="margin-top:8px;font-size:11px;color:var(--text3)"></div>
      </div>
      <div class="card">
        <div class="ct">‚óê Audit (get_audit_summary)</div>
        <div id="i-audit" style="margin-top:8px;font-size:11px;color:var(--text3)">Run inference to populate</div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê TRAINING ‚ïê‚ïê -->
<div class="panel" id="panel-training">
  <div class="ph">
    <div><div class="ph-title">Training</div><div class="ph-sub">AEONTrainer ¬∑ real gradient descent on core.py</div></div>
    <div class="btns">
      <button class="btn btn-danger" id="stop-btn" onclick="stopTrain()" style="display:none">‚ñ† Stop</button>
      <button class="btn btn-primary" id="start-btn" onclick="startTrain()">‚óâ Start Training</button>
    </div>
  </div>
  <div class="g2" style="margin-bottom:16px">
    <div class="card">
      <div class="ct">‚öô Parameters</div>
      <div class="fr" style="margin-top:8px"><div class="fg"><div class="fl">Epochs</div><input type="number" id="t-ep" value="10" min="1" max="1000"></div><div class="fg"><div class="fl">Learning Rate</div><select id="t-lr"><option value="1e-5">1e-5</option><option value="3e-5" selected>3e-5</option><option value="1e-4">1e-4</option></select></div></div>
      <div class="fr"><div class="fg"><div class="fl">Batch Size</div><select id="t-bs"><option value="4">4</option><option value="8">8</option><option value="16" selected>16</option><option value="32">32</option></select></div><div class="fg"><div class="fl">grad_clip</div><div class="rr"><input type="range" id="t-gc" min="0.1" max="5" step="0.1" value="1.0" oninput="rv('t-gc-v',parseFloat(this.value).toFixed(1))"><span class="rv" id="t-gc-v">1.0</span></div></div></div>
      <div class="fr"><div class="fg"><div class="fl">warmup_steps</div><input type="number" id="t-ws" value="100" min="0"></div><div class="fg"><div class="fl">checkpoint_dir</div><input type="text" id="t-ckpt" value="./checkpoints"></div></div>
      <div class="fg"><div class="fl">CLI equivalent</div><div class="cb" style="padding:8px;font-size:11px;color:var(--green)" id="t-cli">python core.py --mode train --epochs 10 --batch-size 16 --lr 3e-5</div></div>
    </div>
    <div>
      <div class="card" style="margin-bottom:12px">
        <div class="ct">‚óâ Status</div>
        <div id="t-idle" style="font-size:12px;color:var(--text3);margin-top:8px">No active training run.</div>
        <div id="t-active" style="display:none">
          <div style="display:flex;justify-content:space-between;margin:8px 0 4px"><span style="font-size:11px;color:var(--text2)" id="t-epoch-lbl">Epoch 0/0</span><span style="font-size:11px;color:var(--accent)" id="t-pct">0%</span></div>
          <div class="prog-track" style="height:6px"><div class="prog-fill" id="t-prog" style="width:0%"></div></div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:12px">
            <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">Train Loss</div><div style="font-family:var(--display);font-size:20px;color:var(--accent)" id="t-loss">‚Äî</div></div>
            <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">Val Loss</div><div style="font-family:var(--display);font-size:20px;color:var(--purple)" id="t-vloss">‚Äî</div></div>
            <div style="text-align:center"><div style="font-size:10px;color:var(--text3)">LR</div><div style="font-family:var(--display);font-size:18px;color:var(--green)" id="t-lr-cur">‚Äî</div></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="ct">Save / Load Checkpoint</div>
        <div class="fr" style="margin-top:8px">
          <div class="fg"><div class="fl">Path</div><input type="text" id="ck-path" value="./checkpoints/aeon_state"></div>
          <div style="display:flex;gap:6px;align-items:flex-end">
            <button class="btn btn-secondary" onclick="saveModel()">‚Üë Save</button>
            <button class="btn btn-ghost" onclick="loadModel()">‚Üì Load</button>
          </div>
        </div>
        <div id="ck-result" style="font-size:11px;margin-top:6px;color:var(--text3)"></div>
      </div>
    </div>
  </div>
  <div class="chart-wrap">
    <div class="chart-head"><div class="chart-title">Training Loss (real data from trainer)</div></div>
    <canvas id="loss-chart" height="160"></canvas>
  </div>
</div>

<!-- ‚ïê‚ïê LOGS ‚ïê‚ïê -->
<div class="panel" id="panel-logs">
  <div class="ph">
    <div><div class="ph-title">Live Logs</div><div class="ph-sub">Real Python logging from core.py via WebSocket SSE</div></div>
    <div class="btns">
      <button class="btn btn-ghost" id="pause-btn" onclick="togglePause()">‚è∏ Pause</button>
      <button class="btn btn-ghost" onclick="clearLogs()">‚úï Clear</button>
      <button class="btn btn-secondary" onclick="exportLogs()">‚Üì Export</button>
    </div>
  </div>
  <div class="log-tb">
    <div class="chip on-INFO" onclick="toggleChip(this,'INFO')">INFO</div>
    <div class="chip on-WARN on-WARNING" onclick="toggleChip(this,'WARN')">WARN</div>
    <div class="chip on-ERROR" onclick="toggleChip(this,'ERROR')">ERROR</div>
    <div class="chip on-DEBUG" onclick="toggleChip(this,'DEBUG')">DEBUG</div>
    <div style="flex:1"></div>
    <input type="text" id="log-search" placeholder="search..." style="width:180px;font-size:11px" oninput="rerenderLogs()">
    <div style="font-size:11px;color:var(--text3)" id="log-cnt">0</div>
  </div>
  <div class="log-wrap" id="log-box"></div>
</div>

<!-- ‚ïê‚ïê AUDIT ‚ïê‚ïê -->
<div class="panel" id="panel-audit">
  <div class="ph">
    <div><div class="ph-title">Audit Trail</div><div class="ph-sub">model.audit_log ¬∑ model.get_recent_decisions() ¬∑ model.get_pattern_insights()</div></div>
    <div class="btns">
      <select id="au-sub" onchange="loadAudit()" style="font-size:12px;padding:5px 8px">
        <option value="">All subsystems</option>
        <option value="safety">safety</option>
        <option value="memory">memory</option>
        <option value="meta_loop">meta_loop</option>
        <option value="vq_vae">vq_vae</option>
        <option value="encoder">encoder</option>
        <option value="causal">causal</option>
      </select>
      <button class="btn btn-secondary" onclick="loadAudit()">‚Üª Refresh</button>
      <button class="btn btn-ghost" onclick="exportAudit()">‚Üì Export</button>
    </div>
  </div>
  <div class="g4" style="margin-bottom:14px">
    <div class="card ca"><div class="ct">Total</div><div class="cv ca" id="au-total">0</div></div>
    <div class="card cg"><div class="ct">Info</div><div class="cv cg" id="au-info">0</div></div>
    <div class="card cw"><div class="ct">Warnings</div><div class="cv cw" id="au-warn">0</div></div>
    <div class="card cd"><div class="ct">Critical</div><div class="cv" style="color:var(--danger)" id="au-crit">0</div></div>
  </div>
  <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--rlg);overflow:hidden;max-height:380px;overflow-y:auto;margin-bottom:14px">
    <table class="tbl" id="au-tbl"><thead><tr><th>Time</th><th>Subsystem</th><th>Severity</th><th>Decision</th><th>Meta</th></tr></thead>
    <tbody id="au-tbody"><tr><td colspan="5" style="color:var(--text3);text-align:center;padding:20px">Initialize model and run inference to generate audit entries</td></tr></tbody></table>
  </div>
  <div class="card"><div class="ct">Pattern Insights (model.audit_log.get_pattern_insights())</div><div id="au-insights" style="margin-top:8px;font-size:12px;color:var(--text3)">Insufficient data</div></div>
</div>

<!-- ‚ïê‚ïê MONITOR ‚ïê‚ïê -->
<div class="panel" id="panel-monitor">
  <div class="ph">
    <div><div class="ph-title">System Monitor</div><div class="ph-sub">SystemIntegrityMonitor ¬∑ integrity_monitor.get_health_score()</div></div>
    <button class="btn btn-secondary" onclick="loadHealth()">‚Üª Refresh</button>
  </div>
  <div class="g3" style="margin-bottom:14px">
    <div class="card cg"><div class="ct">Overall Health</div><div class="cv cg" id="m-health">‚Äî</div><div class="cm-t" id="m-health-m">not initialized</div><div class="mbar" style="margin-top:8px"><div class="mfill g" id="m-health-bar" style="width:0%"></div></div></div>
    <div class="card ca"><div class="ct">NaN Events (TG)</div><div class="cv ca" id="m-nan">0</div><div class="cm-t">total detected</div></div>
    <div class="card cp"><div class="ct">Inf Events (TG)</div><div class="cv cp" id="m-inf">0</div><div class="cm-t">total detected</div></div>
  </div>
  <div class="g2" style="margin-bottom:14px">
    <div class="card"><div class="ct">Subsystem Scores</div><div class="ss-list" id="m-subsys" style="margin-top:8px"><div style="font-size:11px;color:var(--text3)">Initialize model first</div></div></div>
    <div class="card"><div class="ct">Recovery Stats (error_recovery.get_recovery_stats())</div><div id="m-recovery" style="margin-top:8px;font-size:11px;color:var(--text3)">‚Äî</div></div>
  </div>
  <div class="chart-wrap"><div class="chart-head"><div class="chart-title">Health Score History</div></div><canvas id="health-chart" height="150"></canvas></div>
</div>

<!-- ‚ïê‚ïê TENSORGUARD ‚ïê‚ïê -->
<div class="panel" id="panel-tg">
  <div class="ph">
    <div><div class="ph-title">TensorGuard</div><div class="ph-sub">model.tensor_guard.print_report() ¬∑ NaN/Inf tracking</div></div>
    <div class="btns">
      <button class="btn btn-secondary" onclick="loadTG()">‚Üª Refresh</button>
    </div>
  </div>
  <div class="g4" style="margin-bottom:14px">
    <div class="card cg"><div class="ct">Policy</div><div class="cv cg" id="tg-pol" style="font-size:18px">‚Äî</div></div>
    <div class="card cw"><div class="ct">NaN Count</div><div class="cv cw" id="tg-nan">0</div></div>
    <div class="card cd"><div class="ct">Inf Count</div><div class="cv" style="color:var(--danger)" id="tg-inf">0</div></div>
    <div class="card ca"><div class="ct">Sanitized</div><div class="cv ca" id="tg-san">0</div></div>
  </div>
  <div class="card" style="margin-bottom:14px">
    <div class="ct">Recent NaN/Inf Events (context_history)</div>
    <div style="overflow-x:auto;margin-top:8px;max-height:300px;overflow-y:auto">
      <table class="tbl" id="tg-tbl"><thead><tr><th>Context</th><th>Shape</th><th>NaN count</th><th>Inf count</th></tr></thead>
      <tbody id="tg-tbody"><tr><td colspan="4" style="color:var(--text3);text-align:center;padding:20px">No events recorded</td></tr></tbody></table>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê CODE GENERATOR ‚ïê‚ïê -->
<div class="panel" id="panel-codegen">
  <div class="ph"><div><div class="ph-title">Code Generator</div><div class="ph-sub">Python code from current config ‚Üí paste into your scripts</div></div><button class="btn btn-primary" onclick="genCode()">‚öô Generate</button></div>
  <div class="tbar">
    <button class="tbtn active" onclick="codeTab('init')">Init</button>
    <button class="tbtn" onclick="codeTab('infer')">Inference</button>
    <button class="tbtn" onclick="codeTab('train')">Training</button>
    <button class="tbtn" onclick="codeTab('intro')">Introspection</button>
    <button class="tbtn" onclick="codeTab('cli')">CLI</button>
  </div>
  <div class="tpanel active" id="codetab-init"><div class="cb"><button class="cc" onclick="cpCode(this)">copy</button><pre id="code-init" style="margin:0;color:var(--text2)"></pre></div></div>
  <div class="tpanel" id="codetab-infer"><div class="cb"><button class="cc" onclick="cpCode(this)">copy</button><pre id="code-infer" style="margin:0;color:var(--text2)"></pre></div></div>
  <div class="tpanel" id="codetab-train"><div class="cb"><button class="cc" onclick="cpCode(this)">copy</button><pre id="code-train" style="margin:0;color:var(--text2)"></pre></div></div>
  <div class="tpanel" id="codetab-intro"><div class="cb"><button class="cc" onclick="cpCode(this)">copy</button><pre id="code-intro" style="margin:0;color:var(--text2)"></pre></div></div>
  <div class="tpanel" id="codetab-cli"><div class="cb"><button class="cc" onclick="cpCode(this)">copy</button><pre id="code-cli" style="margin:0;color:var(--text2)"></pre></div></div>
</div>

</main>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AEON Dashboard ‚Äî Real API Integration Layer
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const API = window.location.origin; // same origin as server
const WS_URL = API.replace(/^http/, 'ws') + '/ws';

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const S = {
  connected: false,
  modelReady: false,
  ws: null,
  logEntries: [],
  logFilters: new Set(['INFO','WARN','WARNING','ERROR','DEBUG']),
  logPaused: false,
  logBadge: 0,
  activePanel: 'dashboard',
  trainHistory: { loss: [], val: [] },
  healthHistory: [],
  auditData: [],
  pollInterval: null,
  trainPollInterval: null,
};

// ‚îÄ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
setInterval(() => {
  document.getElementById('clock').textContent = new Date().toTimeString().slice(0,8);
}, 1000);

// ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function go(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-' + id).classList.add('active');
  S.activePanel = id;
  S.logBadge = 0;
  document.getElementById('log-badge').textContent = '0';
  event?.currentTarget?.classList.add('active');
  if (id === 'architecture') loadArch();
  if (id === 'audit') loadAudit();
  if (id === 'monitor') loadHealth();
  if (id === 'tg') loadTG();
  if (id === 'codegen') genCode();
  if (id === 'logs') rerenderLogs();
}
document.querySelectorAll('.nav-item').forEach(n => n.addEventListener('click', function(){
  document.querySelectorAll('.nav-item').forEach(m=>m.classList.remove('active'));
  this.classList.add('active');
}));

// ‚îÄ‚îÄ‚îÄ CONFIG TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function cTab(id) {
  const bar = document.getElementById('cfg-tbar');
  bar.querySelectorAll('.tbtn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('#panel-config .tpanel').forEach(p=>p.classList.remove('active'));
  document.getElementById('ctab-'+id).classList.add('active');
  event.target.classList.add('active');
}
function codeTab(id) {
  const panel = document.getElementById('panel-codegen');
  panel.querySelector('.tbar').querySelectorAll('.tbtn').forEach(b=>b.classList.remove('active'));
  panel.querySelectorAll('.tpanel').forEach(p=>p.classList.remove('active'));
  document.getElementById('codetab-'+id).classList.add('active');
  event.target.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ API HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function api(method, path, body) {
  try {
    const opts = { method, headers: {'Content-Type':'application/json'} };
    if (body) opts.body = JSON.stringify(body);
    const r = await fetch(API + path, opts);
    const data = await r.json();
    if (!r.ok) throw new Error(data.detail || r.statusText);
    return data;
  } catch(e) {
    console.error(path, e);
    throw e;
  }
}

// ‚îÄ‚îÄ‚îÄ CONNECTION + WEBSOCKET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function connectWS() {
  setBadge('connecting');
  const ws = new WebSocket(WS_URL);
  S.ws = ws;

  ws.onopen = () => {
    S.connected = true;
    setBadge('connected');
    log('INFO','dashboard','WebSocket connected to AEON server');
    // poll status
    checkStatus();
    S.pollInterval = setInterval(checkStatus, 4000);
  };

  ws.onmessage = (ev) => {
    try {
      const msg = JSON.parse(ev.data);
      if (msg.type === 'log') appendLog(msg.data);
      if (msg.type === 'pong') {
        if (msg.training) updateTrainUI(msg.training);
      }
    } catch(e) {}
  };

  ws.onclose = () => {
    S.connected = false;
    setBadge('disconnected');
    clearInterval(S.pollInterval);
    setTimeout(connectWS, 3000); // auto-reconnect
  };

  ws.onerror = () => { ws.close(); };
}

function sendWS(msg) {
  if (S.ws && S.ws.readyState === 1) S.ws.send(JSON.stringify(msg));
}

// Keep-alive ping + training progress poll
setInterval(() => {
  sendWS({ type: 'ping' });
}, 2000);

async function checkStatus() {
  try {
    const s = await api('GET', '/api/status');
    document.getElementById('dev-str').textContent = s.device || '‚Äî';
    if (s.model_ready !== S.modelReady) {
      S.modelReady = s.model_ready;
      onModelStateChange(s.model_ready);
    }
    // Update no-backend alert
    document.getElementById('no-backend-alert').style.display = 'none';
  } catch(e) {
    document.getElementById('no-backend-alert').style.display = 'flex';
  }
}

function setBadge(state) {
  const badge = document.getElementById('conn-badge');
  const text = document.getElementById('conn-text');
  const dot = document.getElementById('conn-dot');
  badge.className = 'conn-badge ' + state;
  dot.className = 'dot ' + (state === 'connected' ? '' : 'pulse');
  text.textContent = { connected:'Connected', disconnected:'Disconnected', connecting:'Connecting...' }[state];
}

function onModelStateChange(ready) {
  document.getElementById('init-btn').style.display = ready ? 'none' : '';
  document.getElementById('deinit-btn').style.display = ready ? '' : 'none';
  const badge = document.getElementById('inf-status');
  badge.className = ready ? 'badge bg' : 'badge br';
  badge.textContent = ready ? 'model ready' : 'not initialized';
  if (ready) {
    refreshAll();
    log('SUCCESS','dashboard','Model ready ‚Äî all API endpoints available');
  }
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PRESETS_DATA = {
  minimal: {
    encoder_backend:'ssm', decoder_backend:'ssm',
    enable_hierarchical_memory:false, enable_neurogenic_memory:false,
    enable_temporal_memory:false, enable_consolidating_memory:false,
    enable_full_coherence:false, enable_causal_model:false,
    enable_mcts_planner:false, enable_world_model:false,
    enable_auto_critic:false, enable_meta_learning:false,
    vq_num_embeddings:8192, max_iterations:20,
  },
  production: {
    encoder_backend:'mamba2', decoder_backend:'mamba2',
    enable_hierarchical_memory:true, enable_neurogenic_memory:true,
    enable_temporal_memory:true, enable_consolidating_memory:false,
    enable_auto_critic:true, enable_module_coherence:true,
    enable_inference_cache:true, use_amp:true,
    enable_full_coherence:false, enable_mcts_planner:false,
    vq_num_embeddings:8192, max_iterations:20,
  },
  full: {
    encoder_backend:'mamba2', decoder_backend:'mamba2',
    enable_full_coherence:true,
    enable_hierarchical_memory:true, enable_neurogenic_memory:true,
    enable_temporal_memory:true, enable_consolidating_memory:true,
    enable_causal_model:true, enable_notears_causal:true,
    enable_world_model:true, enable_mcts_planner:true,
    enable_auto_critic:true, enable_recursive_meta_loop:true,
    enable_metacognitive_recursion:true, enable_meta_learning:true,
    vq_num_embeddings:16384, max_iterations:50,
  },
};

function applyPreset(name) {
  const p = PRESETS_DATA[name];
  if (!p) return;
  if (p.encoder_backend) document.getElementById('c-enc').value = p.encoder_backend;
  if (p.decoder_backend) document.getElementById('c-dec').value = p.decoder_backend;
  if (p.vq_num_embeddings) document.getElementById('c-vqnum').value = p.vq_num_embeddings;
  if (p.max_iterations) { document.getElementById('c-maxiter').value = p.max_iterations; rv('c-maxiter-v', p.max_iterations); }
  // booleans
  const map = {
    enable_hierarchical_memory:'c-hier-mem', enable_neurogenic_memory:'c-neuro-mem',
    enable_temporal_memory:'c-temp-mem', enable_consolidating_memory:'c-cons-mem',
    enable_full_coherence:'c-fc', enable_causal_model:'c-causal',
    enable_notears_causal:'c-notears', enable_world_model:'c-wm',
    enable_mcts_planner:'c-mcts', enable_auto_critic:'c-ac',
    enable_recursive_meta_loop:'c-rml', enable_metacognitive_recursion:'c-mcr',
    enable_meta_learning:'c-maml', enable_module_coherence:'c-mc',
    enable_cross_validation:'c-cv', enable_hybrid_reasoning:'c-hr',
    enable_inference_cache:'c-infcache', use_amp:'c-amp',
  };
  for (const [k,id] of Object.entries(map)) {
    const el = document.getElementById(id);
    if (el && k in p) el.checked = p[k];
  }
  log('INFO','config','Preset applied: ' + name);
}

function buildInitPayload() {
  const h = parseInt(document.getElementById('q-hidden')?.value || 256);
  const device = document.getElementById('q-device')?.value || 'auto';
  const seed = parseInt(document.getElementById('q-seed')?.value || 42);
  return {
    hidden_dim: h, z_dim: h, vq_embedding_dim: h,
    vocab_size: parseInt(document.getElementById('c-vocab')?.value || 30522),
    seq_length: parseInt(document.getElementById('c-seqlen')?.value || 64),
    num_pillars: 64,
    encoder_backend: document.getElementById('c-enc')?.value || 'ssm',
    decoder_backend: document.getElementById('c-dec')?.value || 'ssm',
    device_str: device,
    max_iterations: parseInt(document.getElementById('c-maxiter')?.value || 50),
    lipschitz_target: parseFloat(document.getElementById('c-lip')?.value || 0.85),
    vq_num_embeddings: parseInt(document.getElementById('c-vqnum')?.value || 8192),
    use_vq: document.getElementById('c-usevq')?.checked ?? true,
    use_amp: document.getElementById('c-amp')?.checked ?? true,
    enable_inference_cache: document.getElementById('c-infcache')?.checked ?? true,
    nan_policy: document.getElementById('c-nanpol')?.value || 'WARN',
    // Memory
    enable_hierarchical_memory: document.getElementById('c-hier-mem')?.checked ?? false,
    hierarchical_working_capacity: parseInt(document.getElementById('c-wc')?.value || 7),
    hierarchical_episodic_capacity: parseInt(document.getElementById('c-ec')?.value || 1000),
    enable_neurogenic_memory: document.getElementById('c-neuro-mem')?.checked ?? false,
    neurogenic_retrieval_weight: parseFloat(document.getElementById('c-nrw')?.value || 0.1),
    neurogenic_retrieval_k: parseInt(document.getElementById('c-nrk')?.value || 3),
    enable_temporal_memory: document.getElementById('c-temp-mem')?.checked ?? false,
    temporal_memory_decay_rate: parseFloat(document.getElementById('c-tmd')?.value || 0.01),
    enable_consolidating_memory: document.getElementById('c-cons-mem')?.checked ?? false,
    // Causal
    enable_causal_model: document.getElementById('c-causal')?.checked ?? false,
    enable_notears_causal: document.getElementById('c-notears')?.checked ?? false,
    notears_num_vars: parseInt(document.getElementById('c-ntvars')?.value || 8),
    lambda_causal_dag: parseFloat(document.getElementById('c-ldag')?.value || 0.01),
    enable_causal_world_model: document.getElementById('c-cawm')?.checked ?? false,
    enable_causal_trace: document.getElementById('c-catrace')?.checked ?? false,
    causal_blend_weight: parseFloat(document.getElementById('c-cbw')?.value || 0.05),
    // Meta
    enable_auto_critic: document.getElementById('c-ac')?.checked ?? false,
    auto_critic_threshold: parseFloat(document.getElementById('c-act')?.value || 0.85),
    auto_critic_max_iterations: parseInt(document.getElementById('c-acmi')?.value || 3),
    enable_recursive_meta_loop: document.getElementById('c-rml')?.checked ?? false,
    recursive_meta_depth: parseInt(document.getElementById('c-rmd')?.value || 3),
    enable_metacognitive_recursion: document.getElementById('c-mcr')?.checked ?? false,
    enable_error_evolution: document.getElementById('c-ee')?.checked ?? false,
    enable_meta_learning: document.getElementById('c-maml')?.checked ?? false,
    meta_ewc_lambda: parseFloat(document.getElementById('c-ewc')?.value || 1000),
    // Coherence
    enable_full_coherence: document.getElementById('c-fc')?.checked ?? false,
    enable_module_coherence: document.getElementById('c-mc')?.checked ?? false,
    enable_cross_validation: document.getElementById('c-cv')?.checked ?? false,
    enable_ns_consistency_check: document.getElementById('c-nsc')?.checked ?? false,
    enable_hybrid_reasoning: document.getElementById('c-hr')?.checked ?? false,
    enable_complexity_estimator: document.getElementById('c-ce')?.checked ?? false,
    // Planning
    enable_world_model: document.getElementById('c-wm')?.checked ?? false,
    world_model_tree_depth: parseInt(document.getElementById('c-wmd')?.value || 3),
    surprise_threshold: parseFloat(document.getElementById('c-st')?.value || 0.5),
    enable_mcts_planner: document.getElementById('c-mcts')?.checked ?? false,
    enable_active_learning_planner: document.getElementById('c-alp')?.checked ?? false,
    enable_hierarchical_vae: document.getElementById('c-hvae')?.checked ?? false,
    seed,
  };
}

async function initModel() {
  if (!S.connected) { alert('Backend not connected'); return; }
  const btn = document.getElementById('init-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Initializing...';
  document.getElementById('init-prog').style.display = 'block';
  document.getElementById('init-error').style.display = 'none';

  const steps = [
    'Setting seed...', 'Parsing config...', 'Validating vq_embedding_dim == z_dim...',
    'Building encoder...', 'Building VQ-VAE...', 'Initializing meta-loop...',
    'Loading memory subsystems...', 'Safety system...', 'TensorGuard...',
    'Decoder...', 'Finalizing...'
  ];
  let stepIdx = 0;
  const pbar = document.getElementById('init-prog-fill');
  const plbl = document.getElementById('init-step-lbl');
  const stepInterval = setInterval(() => {
    if (stepIdx < steps.length) {
      plbl.textContent = steps[stepIdx];
      pbar.style.width = ((stepIdx+1)/steps.length*70) + '%';
      stepIdx++;
    }
  }, 200);

  try {
    // Apply quick preset to config fields first
    const preset = document.getElementById('q-preset').value;
    applyPreset(preset);

    const payload = buildInitPayload();
    const r = await api('POST', '/api/init', payload);
    clearInterval(stepInterval);
    pbar.style.width = '100%';
    plbl.textContent = `‚úì Model ready ¬∑ ${(r.parameters/1e6).toFixed(1)}M parameters`;

    log('SUCCESS','init',`Model initialized ¬∑ ${(r.parameters/1e6).toFixed(1)}M params ¬∑ device=${r.device}`);
    updateDashMetrics(r);
    setTimeout(() => { document.getElementById('init-prog').style.display = 'none'; }, 1500);

  } catch(e) {
    clearInterval(stepInterval);
    document.getElementById('init-error').style.display = 'flex';
    document.getElementById('init-error').innerHTML = `<span>‚úï</span><div><strong>Init failed:</strong> ${e.message}</div>`;
    log('ERROR','init', e.message);
    pbar.style.width = '0%';
  }

  btn.disabled = false;
  btn.innerHTML = '‚ö° Initialize';
  checkStatus();
}

async function deinitModel() {
  await api('POST', '/api/deinit');
  log('WARN','core','Model deinitialized');
  checkStatus();
}

async function applyAndReinit() {
  if (S.modelReady) {
    await api('POST', '/api/deinit');
  }
  await initModel();
}

function updateDashMetrics(r) {
  const p = r.parameters || 0;
  document.getElementById('d-params').textContent = p > 1e6 ? (p/1e6).toFixed(1)+'M' : (p/1e3).toFixed(0)+'K';
  document.getElementById('d-params-m').textContent = 'trainable parameters';
  document.getElementById('d-params-bar').style.width = Math.min(p/5e6*100,100)+'%';
  renderCodebook(0.6 + Math.random()*0.3);
}

// ‚îÄ‚îÄ‚îÄ REFRESH ALL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function refreshAll() {
  if (!S.modelReady) return;
  try {
    const data = await api('GET', '/api/introspect');
    if (data.ok) {
      const p = data.parameters || 0;
      document.getElementById('d-params').textContent = p > 1e6 ? (p/1e6).toFixed(1)+'M' : (p/1e3).toFixed(0)+'K';
      document.getElementById('d-params-m').textContent = 'trainable parameters';
      // Flags count
      const cfg = data.config || {};
      const fc = Object.entries(cfg).filter(([k,v]) => k.startsWith('enable_') && v===true).length;
      document.getElementById('d-flags').textContent = fc;
      document.getElementById('d-flags-bar').style.width = (fc/25*100) + '%';
      // TG
      const tg = data.tensorguard || {};
      document.getElementById('tg-nan-live').textContent = tg.nan_count || 0;
      document.getElementById('tg-inf-live').textContent = tg.inf_count || 0;
      document.getElementById('tg-san-live').textContent = data.tensorguard?.sanitize_count || 0;
      // VQ
      const vq = data.vq_stats || {};
      if (vq.usage_fraction !== undefined) {
        const pct = (vq.usage_fraction*100).toFixed(0);
        document.getElementById('d-vq').textContent = pct + '%';
        document.getElementById('d-vq-m').textContent = 'of ' + (cfg.vq_num_embeddings || 8192) + ' codes';
        document.getElementById('d-vq-bar').style.width = pct + '%';
        renderCodebook(vq.usage_fraction);
      }
      // Audit
      renderRecentDecisions(data.recent_decisions || []);
      // Recovery
      const rec = data.recovery_stats || {};
      renderRecovery(rec);
    }
  } catch(e) {}

  try { await loadHealth(); } catch(e) {}
}

// ‚îÄ‚îÄ‚îÄ HEALTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadHealth() {
  if (!S.modelReady) return;
  try {
    const d = await api('GET', '/api/health');
    const h = d.health_score || 0;
    const pct = (h*100).toFixed(1);
    document.getElementById('d-health').textContent = pct + '%';
    document.getElementById('d-health-m').textContent = h > 0.9 ? 'Excellent' : h > 0.7 ? 'Good' : 'Degraded';
    document.getElementById('d-health-bar').style.width = pct + '%';
    // ring
    document.getElementById('d-ring').setAttribute('stroke-dashoffset', (220*(1-h)).toFixed(1));
    document.getElementById('d-ring').setAttribute('stroke', h > 0.8 ? 'var(--green)' : h > 0.5 ? 'var(--warn)' : 'var(--danger)');
    document.getElementById('d-ring-v').textContent = pct + '%';

    document.getElementById('m-health').textContent = pct + '%';
    document.getElementById('m-health-m').textContent = h > 0.9 ? 'All systems nominal' : 'Degradation detected';
    document.getElementById('m-health-bar').style.width = pct + '%';

    S.healthHistory.push({ t: Date.now(), v: h });
    if (S.healthHistory.length > 120) S.healthHistory.shift();

    // Subsystems
    const subs = d.subsystems || {};
    renderSubsystems(subs);

    if (S.activePanel === 'monitor') drawHealthChart();
  } catch(e) {}
}

function renderSubsystems(subs) {
  const ids = ['d-subsys','m-subsys'];
  const entries = Object.entries(subs);
  if (entries.length === 0) {
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.innerHTML = '<div style="font-size:11px;color:var(--text3)">No subsystem data from SystemIntegrityMonitor</div>';
    });
    return;
  }
  const html = entries.slice(0,8).map(([name, score]) => {
    const s = parseFloat(score);
    const col = s > 0.9 ? 'var(--green)' : s > 0.7 ? 'var(--warn)' : 'var(--danger)';
    return `<div class="ss-item"><div class="ss-dot" style="background:${col}"></div><span class="ss-name">${name}</span><span class="ss-val">${(s*100).toFixed(0)}%</span></div>`;
  }).join('');
  ids.forEach(id => { const el = document.getElementById(id); if (el) el.innerHTML = html || '<div style="font-size:11px;color:var(--text3)">‚Äî</div>'; });
}

function renderCodebook(frac) {
  const c = document.getElementById('d-cbk');
  c.innerHTML = '';
  for (let i = 0; i < 128; i++) {
    const used = Math.random() < frac;
    const d = document.createElement('div');
    d.className = 'cbk-c';
    d.style.background = used ? `hsl(${180 + Math.random()*60}deg,75%,${22+Math.random()*35}%)` : 'var(--surface3)';
    c.appendChild(d);
  }
  document.getElementById('d-cbk-m').textContent = (frac*100).toFixed(0)+'% codes active';
}

function renderRecentDecisions(decisions) {
  const el = document.getElementById('d-decisions');
  if (!decisions.length) { el.innerHTML = '<div style="font-size:11px;color:var(--text3)">No decisions logged yet</div>'; return; }
  el.innerHTML = decisions.slice(0,8).map(d => `
    <div style="display:flex;gap:8px;font-size:11px;padding:3px 6px;background:var(--surface3);border-radius:5px">
      <span style="color:var(--purple);width:70px;flex-shrink:0">${d.subsystem||'‚Äî'}</span>
      <span style="color:${d.severity==='warning'?'var(--warn)':d.severity==='critical'?'var(--danger)':'var(--accent)'}">‚óè</span>
      <span style="color:var(--text2);flex:1">${d.decision||d.message||JSON.stringify(d)}</span>
    </div>`).join('');
}

function renderRecovery(rec) {
  const el = document.getElementById('m-recovery');
  if (!el) return;
  const byClass = rec.by_class || {};
  if (!Object.keys(byClass).length) { el.textContent = 'No recovery events'; return; }
  el.innerHTML = Object.entries(byClass).map(([k,v]) =>
    `<div style="display:flex;justify-content:space-between;padding:2px 0"><span style="color:var(--text3)">${k}</span><span style="color:var(--accent)">${v}</span></div>`
  ).join('');
}

// ‚îÄ‚îÄ‚îÄ ARCHITECTURE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadArch() {
  if (!S.modelReady) return;
  try {
    const d = await api('GET', '/api/architecture');
    document.getElementById('arch-summary').textContent = d.summary || '';
    const cfg = d.config || {};
    document.getElementById('a-enc').textContent = cfg.encoder_backend || '‚Äî';
    document.getElementById('a-dec').textContent = cfg.decoder_backend || '‚Äî';
    document.getElementById('a-vq').textContent = (cfg.vq_num_embeddings||8192)/1000+'K codes';
    document.getElementById('a-ml').textContent = 'Banach FP ¬∑ ' + (cfg.max_iterations||50) + ' iter';
    document.getElementById('a-out').textContent = '[B,L,' + (cfg.hidden_dim||256) + ']';

    const mods = d.modules || [];
    const tbody = document.querySelector('#arch-mod-tbl tbody');
    tbody.innerHTML = mods.map(m => `
      <tr><td style="color:var(--accent)">${m.name}</td>
          <td style="color:var(--purple)">${m.type}</td>
          <td style="color:var(--text3)">${m.params > 1e6 ? (m.params/1e6).toFixed(2)+'M' : (m.params/1e3).toFixed(0)+'K'}</td></tr>
    `).join('');
  } catch(e) { log('ERROR','arch', e.message); }
}

// ‚îÄ‚îÄ‚îÄ INFERENCE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function runInfer() {
  if (!S.modelReady) { log('WARN','inference','Model not initialized'); return; }
  const btn = document.getElementById('i-run-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>';

  const out = document.getElementById('i-out');
  out.innerHTML = '<span class="cursor"></span>';
  document.getElementById('i-meta').style.display = 'none';
  document.getElementById('i-status-line').textContent = 'Calling model.generate()...';

  try {
    const r = await api('POST', '/api/infer', {
      prompt: document.getElementById('i-prompt').value,
      max_length: parseInt(document.getElementById('i-maxlen').value),
      temperature: parseFloat(document.getElementById('i-temp').value),
      top_k: parseInt(document.getElementById('i-topk').value),
      top_p: parseFloat(document.getElementById('i-topp').value),
      fast: document.getElementById('i-fast').checked,
    });

    out.innerHTML = `<span style="color:var(--text2)">${r.text || '[empty output]'}</span>`;
    document.getElementById('i-meta').style.display = 'grid';
    document.getElementById('im-tok').textContent = r.tokens;
    document.getElementById('im-time').textContent = r.elapsed_ms + 'ms';
    document.getElementById('im-tps').textContent = r.tokens_per_sec;
    document.getElementById('i-status-line').textContent =
      `status: ${r.status} ${r.reason ? '¬∑ ' + r.reason : ''}`;

    // Audit summary
    const aud = r.audit || {};
    document.getElementById('i-audit').innerHTML =
      `<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;font-size:11px">
        <div style="background:var(--surface3);padding:6px 8px;border-radius:6px"><div style="color:var(--text3)">total decisions</div><div style="color:var(--accent);font-family:var(--display)">${aud.total||0}</div></div>
        <div style="background:var(--surface3);padding:6px 8px;border-radius:6px"><div style="color:var(--text3)">warnings</div><div style="color:var(--warn);font-family:var(--display)">${aud.warnings||0}</div></div>
      </div>`;

    // TG
    const tg = r.tensorguard || {};
    document.getElementById('tg-nan-live').textContent = tg.nan_count || 0;
    document.getElementById('tg-inf-live').textContent = tg.inf_count || 0;
    document.getElementById('tg-san-live').textContent = tg.sanitize_count || 0;

    log('SUCCESS','inference', `Generated ${r.tokens} tokens ¬∑ ${r.elapsed_ms}ms ¬∑ status=${r.status}`);
    if (S.activePanel === 'audit') loadAudit();

  } catch(e) {
    out.innerHTML = `<span style="color:var(--danger)">Error: ${e.message}</span>`;
    log('ERROR','inference', e.message);
  }
  btn.disabled = false;
  btn.innerHTML = '‚ñ∂ Generate';
}

async function runFwd() {
  if (!S.modelReady) return;
  const ids = document.getElementById('i-fwd-ids').value
    .split(',').map(s=>parseInt(s.trim())).filter(n=>!isNaN(n));
  try {
    const r = await api('POST', '/api/forward', {
      input_ids: ids, fast: document.getElementById('i-fwd-fast').checked
    });
    document.getElementById('fwd-out').style.display = 'block';
    document.getElementById('fwd-keys').innerHTML = (r.output_keys||[]).map(k =>
      `<span class="badge ba">${k}</span>`).join('');
    const safety = r.safety_score;
    document.getElementById('fwd-safety').textContent = safety?.toFixed(4) ?? '‚Äî';
    document.getElementById('fwd-safety').style.color = safety > 0.8 ? 'var(--green)' : 'var(--warn)';
    document.getElementById('fwd-delta').textContent = r.convergence_delta?.toExponential(3) ?? '‚Äî';
    document.getElementById('fwd-top5').textContent = (r.top5_tokens||[]).map((t,i) =>
      `[${t}]=${r.top5_probs?.[i]?.toFixed(4)}`).join(' ¬∑ ');
    log('SUCCESS','forward', `${r.elapsed_ms}ms ¬∑ logits${JSON.stringify(r.logits_shape)} ¬∑ safety=${safety?.toFixed(3)}`);
  } catch(e) { log('ERROR','forward', e.message); }
}

function clearInfer() {
  document.getElementById('i-out').innerHTML = '<span style="color:var(--text3)">Output will appear here...</span>';
  document.getElementById('i-meta').style.display = 'none';
  document.getElementById('i-status-line').textContent = '';
  document.getElementById('fwd-out').style.display = 'none';
  document.getElementById('i-audit').textContent = 'Run inference to populate';
}

// ‚îÄ‚îÄ‚îÄ TRAINING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
['t-ep','t-bs','t-lr'].forEach(id => {
  document.getElementById(id)?.addEventListener('change', updateTrainCLI);
});

function updateTrainCLI() {
  const ep = document.getElementById('t-ep').value;
  const bs = document.getElementById('t-bs').value;
  const lr = document.getElementById('t-lr').value;
  document.getElementById('t-cli').textContent =
    `python core.py --mode train --epochs ${ep} --batch-size ${bs} --lr ${lr}`;
}

async function startTrain() {
  if (!S.modelReady) { log('WARN','training','Model not initialized'); return; }
  S.trainHistory = { loss: [], val: [] };
  try {
    await api('POST', '/api/train/start', {
      num_epochs: parseInt(document.getElementById('t-ep').value),
      batch_size: parseInt(document.getElementById('t-bs').value),
      learning_rate: parseFloat(document.getElementById('t-lr').value),
      gradient_clip_norm: parseFloat(document.getElementById('t-gc').value),
      warmup_steps: parseInt(document.getElementById('t-ws').value),
      checkpoint_dir: document.getElementById('t-ckpt').value,
    });
    document.getElementById('start-btn').style.display = 'none';
    document.getElementById('stop-btn').style.display = '';
    document.getElementById('t-idle').style.display = 'none';
    document.getElementById('t-active').style.display = 'block';
    log('INFO','training','Training started');
    S.trainPollInterval = setInterval(pollTraining, 500);
  } catch(e) { log('ERROR','training', e.message); }
}

async function stopTrain() {
  await api('POST', '/api/train/stop');
  clearInterval(S.trainPollInterval);
  document.getElementById('stop-btn').style.display = 'none';
  document.getElementById('start-btn').style.display = '';
  log('WARN','training','Training stopped by user');
}

async function pollTraining() {
  try {
    const d = await api('GET', '/api/train/progress');
    updateTrainUI(d.progress || {});
  } catch(e) {}
}

function updateTrainUI(p) {
  if (!p || !p.total_epochs) return;
  const pct = Math.round((p.epoch / p.total_epochs) * 100);
  document.getElementById('t-epoch-lbl').textContent = `Epoch ${p.epoch}/${p.total_epochs}`;
  document.getElementById('t-pct').textContent = pct + '%';
  document.getElementById('t-prog').style.width = pct + '%';
  if (p.loss !== null) document.getElementById('t-loss').textContent = p.loss?.toFixed(4) ?? '‚Äî';
  if (p.val_loss !== null) document.getElementById('t-vloss').textContent = p.val_loss?.toFixed(4) ?? '‚Äî';
  if (p.lr !== undefined) document.getElementById('t-lr-cur').textContent = p.lr?.toExponential(1) ?? '‚Äî';
  if (p.loss !== null && p.loss !== undefined) {
    S.trainHistory.loss.push(p.loss);
    S.trainHistory.val.push(p.val_loss || p.loss);
  }
  if (p.done || !p.active) {
    clearInterval(S.trainPollInterval);
    document.getElementById('stop-btn').style.display = 'none';
    document.getElementById('start-btn').style.display = '';
    log('SUCCESS','training','Training complete');
  }
  drawLossChart();
}

async function saveModel() {
  try {
    const r = await api('POST', '/api/save', { path: document.getElementById('ck-path').value });
    document.getElementById('ck-result').textContent = r.ok ? '‚úì Saved to ' + r.path : '‚úï Save failed';
    document.getElementById('ck-result').style.color = r.ok ? 'var(--green)' : 'var(--danger)';
  } catch(e) { document.getElementById('ck-result').textContent = '‚úï ' + e.message; }
}

async function loadModel() {
  try {
    const r = await api('POST', '/api/load', { path: document.getElementById('ck-path').value });
    document.getElementById('ck-result').textContent = r.ok ? '‚úì Loaded from ' + r.path : '‚úï Load failed';
    document.getElementById('ck-result').style.color = r.ok ? 'var(--green)' : 'var(--danger)';
  } catch(e) { document.getElementById('ck-result').textContent = '‚úï ' + e.message; }
}

// ‚îÄ‚îÄ‚îÄ AUDIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadAudit() {
  if (!S.modelReady) return;
  try {
    const sub = document.getElementById('au-sub')?.value || '';
    const d = await api('GET', `/api/audit?subsystem=${sub}`);
    S.auditData = d.entries || [];
    renderAuditTable();
    document.getElementById('au-total').textContent = S.auditData.length;
    document.getElementById('au-info').textContent = S.auditData.filter(e=>e.severity==='info').length;
    document.getElementById('au-warn').textContent = S.auditData.filter(e=>e.severity==='warning').length;
    document.getElementById('au-crit').textContent = S.auditData.filter(e=>e.severity==='critical').length;
    const ins = d.insights || {};
    const el = document.getElementById('au-insights');
    if (Object.keys(ins).length) {
      el.innerHTML = Object.entries(ins).map(([k,v]) =>
        `<div style="display:flex;gap:8px"><span style="color:var(--text3)">${k}:</span><span style="color:var(--accent)">${JSON.stringify(v)}</span></div>`).join('');
    } else {
      el.textContent = 'Insufficient data for pattern analysis';
    }
  } catch(e) {}
}

function renderAuditTable() {
  const tbody = document.getElementById('au-tbody');
  tbody.innerHTML = S.auditData.slice(-100).reverse().map(e => {
    const sev = e.severity || 'info';
    const col = sev==='warning'?'var(--warn)':sev==='critical'?'var(--danger)':'var(--accent)';
    return `<tr>
      <td style="color:var(--text3)">${(e.timestamp||e.ts||'').toString().slice(11,19)}</td>
      <td style="color:var(--purple)">${e.subsystem||'‚Äî'}</td>
      <td style="color:${col}">${sev}</td>
      <td>${e.decision||e.message||'‚Äî'}</td>
      <td style="color:var(--text3);font-size:10px">${JSON.stringify(e.metadata||{}).slice(0,60)}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="5" style="color:var(--text3);text-align:center;padding:20px">No entries</td></tr>';
}

function exportAudit() {
  const blob = new Blob([JSON.stringify(S.auditData, null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='aeon_audit.json'; a.click();
}

// ‚îÄ‚îÄ‚îÄ TENSORGUARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadTG() {
  if (!S.modelReady) return;
  try {
    const d = await api('GET', '/api/tensorguard');
    const r = d.report || {};
    document.getElementById('tg-pol').textContent = r.policy || '‚Äî';
    document.getElementById('tg-nan').textContent = r.nan_count || 0;
    document.getElementById('tg-inf').textContent = r.inf_count || 0;
    document.getElementById('tg-san').textContent = r.sanitize_count || 0;
    document.getElementById('m-nan').textContent = r.nan_count || 0;
    document.getElementById('m-inf').textContent = r.inf_count || 0;
    const hist = r.history || [];
    const tbody = document.getElementById('tg-tbody');
    tbody.innerHTML = hist.length ? hist.slice(-30).map(h =>
      `<tr><td style="color:var(--accent)">${h.context||'‚Äî'}</td><td style="color:var(--text3)">${JSON.stringify(h.shape||[])}</td>
       <td style="color:${h.nan_count>0?'var(--warn)':'var(--text3)'}">${h.nan_count||0}</td>
       <td style="color:${h.inf_count>0?'var(--danger)':'var(--text3)'}">${h.inf_count||0}</td></tr>`).join('')
    : '<tr><td colspan="4" style="color:var(--text3);text-align:center;padding:20px">No NaN/Inf events recorded</td></tr>';
  } catch(e) {}
}

// ‚îÄ‚îÄ‚îÄ LOGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function log(level, subsys, msg) {
  const entry = { time: new Date().toTimeString().slice(0,8), level, subsys, msg, ts: Date.now() };
  S.logEntries.push(entry);
  if (S.logEntries.length > 3000) S.logEntries.shift();
  if (S.activePanel !== 'logs') {
    S.logBadge++;
    document.getElementById('log-badge').textContent = S.logBadge;
  }
  if (!S.logPaused && S.logFilters.has(level)) appendLogDOM(entry);
  document.getElementById('log-cnt').textContent = S.logEntries.length;
}

function appendLog(entry) {
  // from WebSocket / SSE
  const level = entry.level || 'INFO';
  const e = { time: entry.time || new Date().toTimeString().slice(0,8), level, subsys: entry.subsys || entry.name || '‚Äî', msg: entry.msg || entry.message || '', ts: entry.ts || Date.now() };
  S.logEntries.push(e);
  if (S.logEntries.length > 3000) S.logEntries.shift();
  if (S.activePanel !== 'logs') {
    S.logBadge++;
    document.getElementById('log-badge').textContent = S.logBadge;
  }
  if (!S.logPaused && S.logFilters.has(level)) appendLogDOM(e);
  document.getElementById('log-cnt').textContent = S.logEntries.length;
}

function appendLogDOM(entry) {
  const box = document.getElementById('log-box');
  const div = document.createElement('div');
  div.className = 'log-e'; div.dataset.level = entry.level;
  div.innerHTML = `<span class="lt">${entry.time}</span><span class="ll ${entry.level}">${entry.level}</span><span class="ls">${entry.subsys}</span><span class="lm">${entry.msg}</span>`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
  if (box.children.length > 600) box.removeChild(box.firstChild);
}

function toggleChip(chip, level) {
  if (S.logFilters.has(level)) { S.logFilters.delete(level); chip.className = 'chip'; }
  else { S.logFilters.add(level); chip.className = `chip on-${level}`; }
  rerenderLogs();
}

function rerenderLogs() {
  const box = document.getElementById('log-box');
  const search = document.getElementById('log-search').value.toLowerCase();
  box.innerHTML = '';
  S.logEntries.filter(e =>
    S.logFilters.has(e.level) && (!search || e.msg.toLowerCase().includes(search) || e.subsys.toLowerCase().includes(search))
  ).slice(-400).forEach(appendLogDOM);
}

function togglePause() {
  S.logPaused = !S.logPaused;
  document.getElementById('pause-btn').textContent = S.logPaused ? '‚ñ∂ Resume' : '‚è∏ Pause';
}

function clearLogs() { S.logEntries = []; document.getElementById('log-box').innerHTML = ''; document.getElementById('log-cnt').textContent = '0'; }

function exportLogs() {
  const blob = new Blob([JSON.stringify(S.logEntries, null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='aeon_logs.json'; a.click();
}

// ‚îÄ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawLossChart() {
  const canvas = document.getElementById('loss-chart');
  if (!canvas) return;
  const W = canvas.offsetWidth || 600; canvas.width = W;
  const H = canvas.height || 160;
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  const train = S.trainHistory.loss;
  if (train.length < 2) { ctx.fillStyle='#64748b'; ctx.font='11px JetBrains Mono'; ctx.fillText('Start training to see loss curve',W/2-100,H/2); return; }
  const val = S.trainHistory.val;
  const allV = [...train,...val];
  const minV = Math.min(...allV)*0.95, maxV = Math.max(...allV)*1.05;
  const px = i => 36 + (i/(train.length-1))*(W-50);
  const py = v => H-20 - ((v-minV)/(maxV-minV))*(H-32);
  ctx.strokeStyle='#1e2535'; ctx.lineWidth=1;
  for(let i=0;i<=4;i++){const y=12+i*(H-32)/4; ctx.beginPath();ctx.moveTo(36,y);ctx.lineTo(W-14,y);ctx.stroke(); ctx.fillStyle='#64748b';ctx.font='9px JetBrains Mono';ctx.fillText((maxV-i*(maxV-minV)/4).toFixed(3),0,y+3);}
  function line(data,color,dash){
    ctx.beginPath();ctx.strokeStyle=color;ctx.lineWidth=2;if(dash)ctx.setLineDash([4,3]);else ctx.setLineDash([]);
    data.forEach((v,i)=>{const x=px(i),y=py(v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.stroke();ctx.setLineDash([]);
    ctx.beginPath();data.forEach((v,i)=>{const x=px(i),y=py(v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});
    ctx.lineTo(px(data.length-1),H-20);ctx.lineTo(px(0),H-20);ctx.closePath();
    const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,color+'28');g.addColorStop(1,color+'00');ctx.fillStyle=g;ctx.fill();
  }
  line(train,'#00d4ff',false);
  line(val,'#7c3aed',true);
  if(train.length){ctx.beginPath();ctx.arc(px(train.length-1),py(train[train.length-1]),4,0,Math.PI*2);ctx.fillStyle='#00d4ff';ctx.fill();}
}

function drawHealthChart() {
  const canvas = document.getElementById('health-chart');
  if (!canvas) return;
  const W = canvas.offsetWidth || 600; canvas.width = W;
  const H = canvas.height || 150;
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  const data = S.healthHistory;
  if (data.length < 2) { ctx.fillStyle='#64748b';ctx.font='11px JetBrains Mono';ctx.fillText('No health data yet',W/2-60,H/2);return; }
  const minV=0.5,maxV=1;
  const px=i=>30+(i/(data.length-1))*(W-44);
  const py=v=>H-18-((v-minV)/(maxV-minV))*(H-28);
  ctx.strokeStyle='#1e2535';ctx.lineWidth=1;
  for(let i=0;i<=4;i++){const y=10+i*(H-28)/4;ctx.beginPath();ctx.moveTo(30,y);ctx.lineTo(W-14,y);ctx.stroke();ctx.fillStyle='#64748b';ctx.font='9px JetBrains Mono';ctx.fillText((1-i*0.125).toFixed(2),0,y+3);}
  ctx.beginPath();ctx.strokeStyle='#10b981';ctx.lineWidth=2;
  data.forEach((p,i)=>{const x=px(i),y=py(p.v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.stroke();
  ctx.beginPath();data.forEach((p,i)=>{const x=px(i),y=py(p.v);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});
  ctx.lineTo(px(data.length-1),H-18);ctx.lineTo(px(0),H-18);ctx.closePath();
  const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,'#10b98128');g.addColorStop(1,'#10b98100');ctx.fillStyle=g;ctx.fill();
}

// ‚îÄ‚îÄ‚îÄ FORM HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function rv(id, val) { const el = document.getElementById(id); if(el) el.textContent = val; }
function dep(cb, containerId) { const el=document.getElementById(containerId); if(el) el.style.opacity=cb.checked?'1':'0.4'; }
function syncVqDim() { const z=document.getElementById('c-zdim').value; const vq=document.getElementById('c-vqemb'); if(vq) vq.value=z; checkVq(); }
function checkVq() {
  const z=document.getElementById('c-zdim')?.value, vq=document.getElementById('c-vqemb')?.value;
  const hint=document.getElementById('vq-hint');
  if(!hint) return;
  if(z===vq){hint.textContent='‚úì matches z_dim';hint.style.color='var(--green)';}
  else{hint.textContent='‚ö† MUST equal z_dim ('+z+')';hint.style.color='var(--danger)';}
}
function onFC(cb) {
  if(cb.checked){
    ['c-mc','c-cv','c-nsc','c-hr','c-ce'].forEach(id=>{const el=document.getElementById(id);if(el)el.checked=true;});
  }
}
function resetCfg() { applyPreset('production'); }
function copyCfgJSON() {
  const p = buildInitPayload();
  navigator.clipboard.writeText(JSON.stringify(p,null,2));
  log('INFO','config','Config JSON copied to clipboard');
}

// ‚îÄ‚îÄ‚îÄ CODE GENERATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function genCode() {
  const p = buildInitPayload();
  const flags = Object.entries(p).filter(([k,v])=>k.startsWith('enable_')&&v===true).map(([k])=>`    ${k}=True,`).join('\n');
  document.getElementById('code-init').textContent = `from core import AEONConfig, AEONDeltaV3, set_seed
import torch

set_seed(${p.seed||42})

config = AEONConfig(
    hidden_dim=${p.hidden_dim},
    z_dim=${p.z_dim},
    vq_embedding_dim=${p.vq_embedding_dim},
    vq_num_embeddings=${p.vq_num_embeddings},
    vocab_size=${p.vocab_size},
    seq_length=${p.seq_length},
    encoder_backend="${p.encoder_backend}",
    decoder_backend="${p.decoder_backend}",
    device_str="${p.device_str}",
    max_iterations=${p.max_iterations},
    lipschitz_target=${p.lipschitz_target},
    nan_policy="${p.nan_policy}",
${flags}
)

model = AEONDeltaV3(config)
model.eval()
print(f"Parameters: {model.count_parameters():,}")`;

  document.getElementById('code-infer').textContent = `result = model.generate(
    "What is consciousness?",
    max_length=${p.seq_length},
    temperature=0.8,
    top_k=50,
)
print(result['text'])
print(f"Status: {result['status']}")

# Raw forward pass
x = torch.randint(0, ${p.vocab_size}, (1, ${p.seq_length}))
with torch.no_grad():
    out = model(x)
print(out.keys())
print(f"Logits: {out['logits'].shape}")
print(f"Safety: {out['safety_score']}")`;

  document.getElementById('code-train').textContent = `from core import AEONTrainer
from torch.utils.data import Dataset

class TextDataset(Dataset):
    def __init__(self, ids): self.data = ids
    def __len__(self): return len(self.data)
    def __getitem__(self, i): return {'input_ids': self.data[i], 'labels': self.data[i]}

trainer = AEONTrainer(model=model, config=config,
    train_dataset=TextDataset(train_ids),
    eval_dataset=TextDataset(eval_ids))
trainer.train(num_epochs=10)
model.save_state("./checkpoints/aeon_state")`;

  document.getElementById('code-intro').textContent = `# Audit log
summary = model.get_audit_summary()
recent  = model.get_recent_decisions(10)
warnings = model.audit_log.filter_by(subsystem="safety", min_severity="warning")
insights = model.audit_log.get_pattern_insights()
model.audit_log.export_json("audit.json")

# TensorGuard
model.tensor_guard.print_report()

# Recovery stats
stats = model.error_recovery.get_recovery_stats()
print(stats['by_class'])

# Architecture
model.print_architecture_summary()
print(f"Params: {model.count_parameters():,}")

# Config save/load
config.save("config.json")
config2 = AEONConfig.load("config.json")`;

  document.getElementById('code-cli').textContent = `# Demo
python core.py --mode demo --device auto

# Training
python core.py --mode train --epochs 10 --batch-size 16 --lr 3e-5

# Inference
python core.py --mode infer --prompt "What is consciousness?" --max-length ${p.seq_length}

# Full test suite
python core.py --mode test

# With config file
python core.py --mode train --config aeon_config.json`;
}

function cpCode(btn) {
  const pre = btn.nextElementSibling;
  navigator.clipboard.writeText(pre?.textContent || '');
  btn.textContent = '‚úì'; setTimeout(() => btn.textContent = 'copy', 1500);
}

// ‚îÄ‚îÄ‚îÄ RESIZE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('resize', () => {
  if (S.activePanel === 'training') drawLossChart();
  if (S.activePanel === 'monitor') drawHealthChart();
});

// ‚îÄ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
connectWS();
log('INFO','dashboard','AEON Dashboard initializing ¬∑ connecting to server...');
genCode();
// Initial SSE log fetch (fallback if WS fails)
async function fetchInitLogs() {
  try {
    const d = await api('GET', '/api/logs?limit=100');
    (d.logs||[]).forEach(appendLog);
  } catch(e) {}
}
setTimeout(fetchInitLogs, 1500);
</script>
</body>
</html>
